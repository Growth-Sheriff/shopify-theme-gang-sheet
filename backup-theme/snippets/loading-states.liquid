{% comment %}
  ============================================
  LOADING SPINNER & TOAST NOTIFICATIONS SNIPPET
  Include in theme.liquid before </body>
  Usage: {% render 'loading-states' %}
  ============================================
{% endcomment %}

<style>
/* ===== GLOBAL LOADING OVERLAY ===== */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.loading-overlay.active {
  opacity: 1;
  visibility: visible;
}

/* Spinner Styles */
.loading-spinner {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
}

.loading-spinner-ring {
  width: 50px;
  height: 50px;
  border: 3px solid rgba(115, 103, 240, 0.2);
  border-top-color: #7367f0;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.loading-spinner-ring.white {
  border-color: rgba(255, 255, 255, 0.3);
  border-top-color: #fff;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-spinner-text {
  font-size: 0.9rem;
  color: #5d596c;
  font-weight: 500;
}

/* Dots Loading */
.loading-dots {
  display: flex;
  gap: 6px;
}

.loading-dots span {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #7367f0;
  animation: dotPulse 1.4s infinite ease-in-out both;
}

.loading-dots span:nth-child(1) { animation-delay: -0.32s; }
.loading-dots span:nth-child(2) { animation-delay: -0.16s; }
.loading-dots span:nth-child(3) { animation-delay: 0; }

@keyframes dotPulse {
  0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
  40% { transform: scale(1); opacity: 1; }
}

/* Pulse Loading */
.loading-pulse {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, #7367f0, #9e95f5);
  position: relative;
}

.loading-pulse::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: inherit;
  animation: pulse 1.5s ease-out infinite;
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  100% { transform: scale(2); opacity: 0; }
}

/* Skeleton Loading */
.skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: skeleton-shimmer 1.5s infinite;
  border-radius: 4px;
}

.skeleton-text {
  height: 14px;
  margin-bottom: 8px;
}

.skeleton-text.short {
  width: 60%;
}

.skeleton-text.medium {
  width: 80%;
}

.skeleton-image {
  width: 100%;
  aspect-ratio: 1;
  border-radius: 12px;
}

.skeleton-card {
  padding: 16px;
  border-radius: 12px;
  background: #fff;
}

@keyframes skeleton-shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Button Loading State */
.btn-loading {
  position: relative;
  pointer-events: none;
  color: transparent !important;
}

.btn-loading::after {
  content: '';
  position: absolute;
  width: 18px;
  height: 18px;
  top: 50%;
  left: 50%;
  margin-top: -9px;
  margin-left: -9px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* ===== TOAST NOTIFICATIONS ===== */
.toast-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 99999;
  display: flex;
  flex-direction: column;
  gap: 12px;
  pointer-events: none;
}

.toast {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 16px 20px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
  min-width: 300px;
  max-width: 400px;
  transform: translateX(120%);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  pointer-events: auto;
}

.toast.show {
  transform: translateX(0);
  opacity: 1;
}

.toast-icon {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.toast-icon i {
  font-size: 1rem;
}

.toast.success .toast-icon {
  background: rgba(40, 199, 111, 0.1);
  color: #28c76f;
}

.toast.error .toast-icon {
  background: rgba(234, 84, 85, 0.1);
  color: #ea5455;
}

.toast.warning .toast-icon {
  background: rgba(255, 159, 67, 0.1);
  color: #ff9f43;
}

.toast.info .toast-icon {
  background: rgba(115, 103, 240, 0.1);
  color: #7367f0;
}

.toast-content {
  flex: 1;
}

.toast-title {
  font-size: 0.95rem;
  font-weight: 600;
  color: #2d2d3a;
  margin: 0 0 4px 0;
}

.toast-message {
  font-size: 0.85rem;
  color: #6c757d;
  margin: 0;
  line-height: 1.4;
}

.toast-close {
  background: none;
  border: none;
  cursor: pointer;
  color: #9a97a8;
  padding: 4px;
  margin-top: -4px;
  margin-right: -8px;
  transition: color 0.3s ease;
}

.toast-close:hover {
  color: #5d596c;
}

.toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: #7367f0;
  border-radius: 0 0 12px 12px;
  animation: toastProgress 5s linear forwards;
}

.toast.success .toast-progress {
  background: #28c76f;
}

.toast.error .toast-progress {
  background: #ea5455;
}

.toast.warning .toast-progress {
  background: #ff9f43;
}

@keyframes toastProgress {
  from { width: 100%; }
  to { width: 0%; }
}

/* ===== RESPONSIVE ===== */
@media (max-width: 767.98px) {
  .toast-container {
    top: auto;
    bottom: 80px;
    right: 16px;
    left: 16px;
  }
  
  .toast {
    min-width: auto;
    max-width: 100%;
  }
}
</style>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loading-overlay">
  <div class="loading-spinner">
    <div class="loading-spinner-ring"></div>
    <span class="loading-spinner-text" id="loading-text">Loading...</span>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

<script>
// ===== LOADING STATES SYSTEM =====
const LoadingState = {
  overlay: null,
  textEl: null,
  
  init() {
    this.overlay = document.getElementById('loading-overlay');
    this.textEl = document.getElementById('loading-text');
  },
  
  show(text = 'Loading...') {
    if (!this.overlay) this.init();
    if (this.textEl) this.textEl.textContent = text;
    this.overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
  },
  
  hide() {
    if (!this.overlay) return;
    this.overlay.classList.remove('active');
    document.body.style.overflow = '';
  }
};

// ===== TOAST NOTIFICATION SYSTEM =====
const Toast = {
  container: null,
  
  init() {
    this.container = document.getElementById('toast-container');
  },
  
  show(options) {
    if (!this.container) this.init();
    
    const {
      type = 'info',
      title = '',
      message = '',
      duration = 5000,
      showProgress = true
    } = options;
    
    const icons = {
      success: 'fa-check',
      error: 'fa-times',
      warning: 'fa-exclamation',
      info: 'fa-info'
    };
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
      <div class="toast-icon">
        <i class="fa-solid ${icons[type]}"></i>
      </div>
      <div class="toast-content">
        ${title ? `<h4 class="toast-title">${title}</h4>` : ''}
        ${message ? `<p class="toast-message">${message}</p>` : ''}
      </div>
      <button class="toast-close" onclick="this.closest('.toast').remove()">
        <i class="fa-solid fa-times"></i>
      </button>
      ${showProgress ? '<div class="toast-progress"></div>' : ''}
    `;
    
    this.container.appendChild(toast);
    
    // Trigger animation
    setTimeout(() => toast.classList.add('show'), 10);
    
    // Auto remove
    if (duration > 0) {
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 400);
      }, duration);
    }
    
    return toast;
  },
  
  success(message, title = 'Success') {
    return this.show({ type: 'success', title, message });
  },
  
  error(message, title = 'Error') {
    return this.show({ type: 'error', title, message });
  },
  
  warning(message, title = 'Warning') {
    return this.show({ type: 'warning', title, message });
  },
  
  info(message, title = 'Info') {
    return this.show({ type: 'info', title, message });
  }
};

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  LoadingState.init();
  Toast.init();
});

// Export to window for global access
window.LoadingState = LoadingState;
window.Toast = Toast;
</script>
