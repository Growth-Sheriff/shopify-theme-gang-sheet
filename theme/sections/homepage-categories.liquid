{% comment %}
  Homepage Categories - Instagram Story Style + Review Bar
  cp Design System - Fully Customizable
{% endcomment %}

<div class="cp-story-section">
  <div class="container">
    <!-- Story Categories -->
    <div class="cp-story-container">
      {% for block in section.blocks %}
        {% if block.type == 'category' %}
          <a href="{{ block.settings.link | default: '#' }}" class="cp-story-item {% if block.settings.active %}active{% endif %}" {{ block.shopify_attributes }}>
            <div class="cp-story-ring">
              <div class="cp-story-avatar" style="{% if block.settings.bg_color %}background: {{ block.settings.bg_color }};{% endif %}">
                {% if block.settings.image %}
                  <img src="{{ block.settings.image | image_url: width: 80 }}" alt="{{ block.settings.title }}">
                {% else %}
                  <i class="{{ block.settings.icon | default: 'fa-solid fa-star' }}"></i>
                {% endif %}
              </div>
            </div>
            <span class="cp-story-label">{{ block.settings.title }}</span>
          </a>
        {% endif %}
      {% endfor %}
    </div>
    
    <!-- Review Trust Bar -->
    <div class="cp-review-bar">
      <!-- Stars & Review Count -->
      <div class="cp-review-bar-stars">
        {% for i in (1..5) %}
          {% if i <= section.settings.star_rating %}
            <i class="fa-solid fa-star"></i>
          {% else %}
            <i class="fa-regular fa-star"></i>
          {% endif %}
        {% endfor %}
        <span>{{ section.settings.review_count }} reviews</span>
      </div>
      
      <!-- User Avatars -->
      <div class="cp-review-bar-avatars">
        {% for block in section.blocks %}
          {% if block.type == 'review_avatar' %}
            <div class="cp-review-bar-avatar" {{ block.shopify_attributes }}>
              {% if block.settings.image %}
                <img src="{{ block.settings.image | image_url: width: 100 }}" alt="{{ block.settings.name | default: 'Customer' }}">
              {% else %}
                <img src="{{ block.settings.image_url | default: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop' }}" alt="{{ block.settings.name | default: 'Customer' }}">
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </div>
      
      <!-- Video Count -->
      <div class="cp-review-bar-video">
        <i class="fa-solid fa-video"></i>
        <span>{{ section.settings.video_count }}</span>
      </div>
      
      <!-- Recommendation Badge -->
      <div class="cp-review-bar-badge">
        <i class="fa-solid fa-thumbs-up"></i>
        <span>{{ section.settings.recommend_percent }}% {{ section.settings.recommend_text }}</span>
      </div>
    </div>
  </div>
</div>

<style>
  /* Story Section Styles */
  .cp-story-section {
    padding: 1rem 0 2rem;
    background: transparent;
  }
  
  .cp-story-container {
    display: flex;
    gap: 2rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
    padding: 1rem 2rem;
    max-width: 1000px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .cp-story-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    transition: transform 0.2s ease;
    min-width: 85px;
  }
  
  .cp-story-item:hover {
    transform: translateY(-3px);
  }
  
  .cp-story-ring {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    padding: 3px;
    background: linear-gradient(135deg, {{ section.settings.ring_color_1 | default: '#7367F0' }}, {{ section.settings.ring_color_2 | default: '#ce9ffc' }});
  }
  
  .cp-story-item.active .cp-story-ring {
    background: linear-gradient(135deg, {{ section.settings.active_ring_color_1 | default: '#7367F0' }}, {{ section.settings.active_ring_color_2 | default: '#FF6B6B' }});
    box-shadow: 0 4px 15px rgba(115, 103, 240, 0.4);
  }
  
  .cp-story-avatar {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: {{ section.settings.avatar_bg | default: '#f8f7fa' }};
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid #fff;
    overflow: hidden;
  }
  
  .cp-story-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .cp-story-avatar i {
    font-size: 1.5rem;
    color: {{ section.settings.icon_color | default: '#7367F0' }};
  }
  
  .cp-story-label {
    font-size: 0.8rem;
    font-weight: 500;
    color: {{ section.settings.label_color | default: '#5d596c' }};
    text-align: center;
    max-width: 90px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  /* Review Bar Styles */
  .cp-review-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    flex-wrap: wrap;
    padding: 1rem 1.5rem;
    background: {{ section.settings.review_bar_bg | default: 'rgba(255,255,255,0.9)' }};
    backdrop-filter: blur(10px);
    border-radius: {{ section.settings.review_bar_radius | default: '50px' }};
    box-shadow: {{ section.settings.review_bar_shadow | default: '0 4px 20px rgba(0,0,0,0.08)' }};
    max-width: fit-content;
    margin: 0 auto;
  }
  
  .cp-review-bar-stars {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }
  
  .cp-review-bar-stars i {
    color: {{ section.settings.star_color | default: '#FFB400' }};
    font-size: 0.875rem;
  }
  
  .cp-review-bar-stars span {
    margin-left: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: {{ section.settings.review_text_color | default: '#5d596c' }};
  }
  
  .cp-review-bar-avatars {
    display: flex;
  }
  
  .cp-review-bar-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    overflow: hidden;
    border: 2px solid #fff;
    margin-left: -8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .cp-review-bar-avatar:first-child {
    margin-left: 0;
  }
  
  .cp-review-bar-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .cp-review-bar-video {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    background: {{ section.settings.video_badge_bg | default: '#fee2e2' }};
    border-radius: 20px;
  }
  
  .cp-review-bar-video i {
    color: {{ section.settings.video_icon_color | default: '#ef4444' }};
    font-size: 0.75rem;
  }
  
  .cp-review-bar-video span {
    font-size: 0.75rem;
    font-weight: 600;
    color: {{ section.settings.video_text_color | default: '#ef4444' }};
  }
  
  .cp-review-bar-badge {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 1rem;
    background: {{ section.settings.badge_bg | default: 'linear-gradient(135deg, #22c55e, #16a34a)' }};
    border-radius: 25px;
    color: #fff;
    font-size: 0.8125rem;
    font-weight: 600;
  }
  
  .cp-review-bar-badge i {
    font-size: 0.875rem;
  }
  
  @media (max-width: 768px) {
    .cp-story-container {
      gap: 1rem;
    }
    
    .cp-review-bar {
      gap: 1rem;
      padding: 0.75rem 1rem;
    }
  }
</style>

{% schema %}
{
  "name": "Stories & Reviews",
  "tag": "div",
  "class": "homepage-categories-section",
  "settings": [
    {
      "type": "header",
      "content": "Story Ring Colors"
    },
    {
      "type": "color",
      "id": "ring_color_1",
      "label": "Ring Gradient Start",
      "default": "#7367F0"
    },
    {
      "type": "color",
      "id": "ring_color_2",
      "label": "Ring Gradient End",
      "default": "#ce9ffc"
    },
    {
      "type": "color",
      "id": "active_ring_color_1",
      "label": "Active Ring Start",
      "default": "#7367F0"
    },
    {
      "type": "color",
      "id": "active_ring_color_2",
      "label": "Active Ring End",
      "default": "#FF6B6B"
    },
    {
      "type": "color",
      "id": "avatar_bg",
      "label": "Avatar Background",
      "default": "#f8f7fa"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon Color",
      "default": "#7367F0"
    },
    {
      "type": "color",
      "id": "label_color",
      "label": "Label Color",
      "default": "#5d596c"
    },
    {
      "type": "header",
      "content": "Review Bar Settings"
    },
    {
      "type": "range",
      "id": "star_rating",
      "label": "Star Rating",
      "min": 1,
      "max": 5,
      "default": 5
    },
    {
      "type": "text",
      "id": "review_count",
      "label": "Review Count",
      "default": "18,624"
    },
    {
      "type": "text",
      "id": "video_count",
      "label": "Video Count",
      "default": "985+"
    },
    {
      "type": "range",
      "id": "recommend_percent",
      "label": "Recommend Percentage",
      "min": 0,
      "max": 100,
      "default": 99
    },
    {
      "type": "text",
      "id": "recommend_text",
      "label": "Recommend Text",
      "default": "Recommended"
    },
    {
      "type": "header",
      "content": "Review Bar Styling"
    },
    {
      "type": "color_background",
      "id": "review_bar_bg",
      "label": "Bar Background",
      "default": "linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%)"
    },
    {
      "type": "text",
      "id": "review_bar_radius",
      "label": "Border Radius",
      "default": "50px"
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star Color",
      "default": "#FFB400"
    },
    {
      "type": "color",
      "id": "review_text_color",
      "label": "Review Text Color",
      "default": "#5d596c"
    },
    {
      "type": "color",
      "id": "video_badge_bg",
      "label": "Video Badge Background",
      "default": "#fee2e2"
    },
    {
      "type": "color",
      "id": "video_icon_color",
      "label": "Video Icon Color",
      "default": "#ef4444"
    },
    {
      "type": "color_background",
      "id": "badge_bg",
      "label": "Recommend Badge BG",
      "default": "linear-gradient(135deg, #22c55e, #16a34a)"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category Story",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "DTF Transfer"
        },
        {
          "type": "text",
          "id": "icon",
          "label": "Icon Class (FontAwesome)",
          "default": "fa-solid fa-shirt",
          "info": "e.g. fa-solid fa-shirt"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Custom Image (optional)"
        },
        {
          "type": "color",
          "id": "bg_color",
          "label": "Background Color",
          "default": "#f8f7fa"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "checkbox",
          "id": "active",
          "label": "Active State",
          "default": false
        }
      ]
    },
    {
      "type": "review_avatar",
      "name": "Review Avatar",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Avatar Image"
        },
        {
          "type": "url",
          "id": "image_url",
          "label": "Image URL (fallback)",
          "info": "Use if no image uploaded"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Customer Name",
          "default": "Customer"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Stories & Reviews",
      "blocks": [
        { "type": "category", "settings": { "title": "DTF Transfer", "icon": "fa-solid fa-shirt", "active": true } },
        { "type": "category", "settings": { "title": "Gang Sheet", "icon": "fa-solid fa-table-cells" } },
        { "type": "category", "settings": { "title": "UV DTF", "icon": "fa-solid fa-sun" } },
        { "type": "category", "settings": { "title": "Rhinestone", "icon": "fa-solid fa-gem" } },
        { "type": "category", "settings": { "title": "Screen Print", "icon": "fa-solid fa-print" } },
        { "type": "category", "settings": { "title": "Vinyl HTV", "icon": "fa-solid fa-fire" } },
        { "type": "category", "settings": { "title": "Blank T-Shirt", "icon": "fa-solid fa-tags" } },
        { "type": "category", "settings": { "title": "Supplies", "icon": "fa-solid fa-box" } },
        { "type": "review_avatar", "settings": { "image_url": "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop", "name": "Sarah" } },
        { "type": "review_avatar", "settings": { "image_url": "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop", "name": "John" } },
        { "type": "review_avatar", "settings": { "image_url": "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop", "name": "Emily" } },
        { "type": "review_avatar", "settings": { "image_url": "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop", "name": "Mike" } },
        { "type": "review_avatar", "settings": { "image_url": "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop", "name": "Lisa" } }
      ]
    }
  ]
}
{% endschema %}
