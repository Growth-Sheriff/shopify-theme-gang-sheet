{% comment %}
  ============================================
  SIZE GUIDE SECTION
  Modal-based size chart with multiple options
  ============================================
{% endcomment %}
{%- render 'custom-css-renderer', section: section -%}

<style>
/* ===== SIZE GUIDE STYLES ===== */
.size-guide-trigger {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.9rem;
  color: #7367f0;
  cursor: pointer;
  transition: all 0.3s ease;
  background: none;
  border: none;
  padding: 0;
}

.size-guide-trigger:hover {
  text-decoration: underline;
}

.size-guide-trigger i {
  font-size: 0.85rem;
}

/* Modal */
.size-guide-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
  z-index: 9998;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.size-guide-overlay.active {
  opacity: 1;
  visibility: visible;
}

.size-guide-modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.95);
  width: 95%;
  max-width: 700px;
  max-height: 90vh;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  overflow: hidden;
}

.size-guide-modal.active {
  opacity: 1;
  visibility: visible;
  transform: translate(-50%, -50%) scale(1);
}

.size-guide-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px;
  border-bottom: 1px solid #eee;
}

.size-guide-title {
  font-size: 1.3rem;
  font-weight: 700;
  color: #2d2d3a;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.size-guide-title i {
  color: #7367f0;
}

.size-guide-close {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: #f8f9fc;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.size-guide-close:hover {
  background: #ea5455;
  color: #fff;
}

.size-guide-close i {
  font-size: 0.9rem;
  color: #5d596c;
}

.size-guide-close:hover i {
  color: #fff;
}

.size-guide-body {
  padding: 24px;
  overflow-y: auto;
  max-height: calc(90vh - 80px);
}

/* Unit Toggle */
.size-unit-toggle {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
  margin-bottom: 20px;
}

.size-unit-toggle span {
  font-size: 0.85rem;
  color: #5d596c;
}

.size-unit-btn {
  padding: 6px 14px;
  border: 1px solid #e0e0e0;
  background: #fff;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 600;
  color: #5d596c;
  cursor: pointer;
  transition: all 0.3s ease;
}

.size-unit-btn.active {
  background: #7367f0;
  color: #fff;
  border-color: #7367f0;
}

/* Size Table */
.size-guide-table-wrapper {
  overflow-x: auto;
  margin-bottom: 24px;
}

.size-guide-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}

.size-guide-table th,
.size-guide-table td {
  padding: 12px 16px;
  text-align: center;
  border-bottom: 1px solid #eee;
}

.size-guide-table th {
  background: linear-gradient(135deg, rgba(115, 103, 240, 0.1), rgba(158, 149, 245, 0.1));
  font-weight: 600;
  color: #2d2d3a;
}

.size-guide-table th:first-child {
  border-radius: 8px 0 0 0;
}

.size-guide-table th:last-child {
  border-radius: 0 8px 0 0;
}

.size-guide-table td {
  color: #5d596c;
}

.size-guide-table tr:hover td {
  background: rgba(115, 103, 240, 0.03);
}

.size-guide-table td:first-child {
  font-weight: 600;
  color: #7367f0;
}

/* How to Measure */
.size-guide-measure {
  background: #f8f9fc;
  border-radius: 16px;
  padding: 24px;
}

.size-guide-measure h4 {
  font-size: 1rem;
  font-weight: 600;
  color: #2d2d3a;
  margin: 0 0 16px 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.size-guide-measure h4 i {
  color: #7367f0;
}

.size-guide-measure-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
}

.measure-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.measure-icon {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #7367f0;
  font-size: 0.9rem;
  flex-shrink: 0;
}

.measure-content h5 {
  font-size: 0.85rem;
  font-weight: 600;
  color: #2d2d3a;
  margin: 0 0 4px 0;
}

.measure-content p {
  font-size: 0.8rem;
  color: #6c757d;
  margin: 0;
  line-height: 1.5;
}

/* Fit Tips */
.size-guide-tips {
  margin-top: 20px;
  padding: 16px 20px;
  background: rgba(115, 103, 240, 0.05);
  border-radius: 12px;
  border-left: 4px solid #7367f0;
}

.size-guide-tips h5 {
  font-size: 0.9rem;
  font-weight: 600;
  color: #2d2d3a;
  margin: 0 0 8px 0;
}

.size-guide-tips p {
  font-size: 0.85rem;
  color: #5d596c;
  margin: 0;
  line-height: 1.6;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 767.98px) {
  .size-guide-modal {
    max-height: 95vh;
  }
  
  .size-guide-header {
    padding: 16px 20px;
  }
  
  .size-guide-title {
    font-size: 1.1rem;
  }
  
  .size-guide-body {
    padding: 20px;
  }
  
  .size-guide-table th,
  .size-guide-table td {
    padding: 10px 12px;
    font-size: 0.8rem;
  }
  
  .size-guide-measure-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<!-- Size Guide Modal -->
<div class="size-guide-overlay" id="size-guide-overlay" onclick="SizeGuide.close()"></div>
<div class="size-guide-modal" id="size-guide-modal">
  <div class="size-guide-header">
    <h3 class="size-guide-title">
      <i class="fa-solid fa-ruler"></i>
      {{ section.settings.title | default: 'Size Guide' }}
    </h3>
    <button class="size-guide-close" onclick="SizeGuide.close()">
      <i class="fa-solid fa-times"></i>
    </button>
  </div>
  
  <div class="size-guide-body">
    
    <!-- Unit Toggle -->
    {%- if section.settings.show_unit_toggle -%}
      <div class="size-unit-toggle">
        <span>Unit:</span>
        <button class="size-unit-btn active" onclick="SizeGuide.toggleUnit('in', this)">Inches</button>
        <button class="size-unit-btn" onclick="SizeGuide.toggleUnit('cm', this)">CM</button>
      </div>
    {%- endif -%}
    
    <!-- Size Table -->
    <div class="size-guide-table-wrapper">
      <table class="size-guide-table" id="size-guide-table">
        <thead>
          <tr>
            <th>{{ section.settings.size_label | default: 'Size' }}</th>
            {%- for block in section.blocks -%}
              {%- if block.type == 'measurement' -%}
                <th>{{ block.settings.measurement_name }}</th>
              {%- endif -%}
            {%- endfor -%}
          </tr>
        </thead>
        <tbody>
          {%- assign sizes = section.settings.sizes | split: ',' -%}
          {%- for size in sizes -%}
            <tr>
              <td>{{ size | strip }}</td>
              {%- for block in section.blocks -%}
                {%- if block.type == 'measurement' -%}
                  {%- assign row_index = forloop.parentloop.index | minus: 1 -%}
                  {%- assign all_values = block.settings.values_in | split: ',' -%}
                  <td data-in="{{ all_values[row_index] | strip }}" data-cm="{% assign cm_values = block.settings.values_cm | split: ',' %}{{ cm_values[row_index] | strip }}">
                    {{ all_values[row_index] | strip }}"
                  </td>
                {%- endif -%}
              {%- endfor -%}
            </tr>
          {%- endfor -%}
        </tbody>
      </table>
    </div>
    
    <!-- How to Measure -->
    {%- if section.settings.show_how_to_measure -%}
      <div class="size-guide-measure">
        <h4>
          <i class="fa-solid fa-tape"></i>
          {{ section.settings.measure_title | default: 'How to Measure' }}
        </h4>
        <div class="size-guide-measure-grid">
          {%- for block in section.blocks -%}
            {%- if block.type == 'measure_instruction' -%}
              <div class="measure-item" {{ block.shopify_attributes }}>
                <div class="measure-icon">
                  <i class="{{ block.settings.icon | default: 'fa-solid fa-ruler' }}"></i>
                </div>
                <div class="measure-content">
                  <h5>{{ block.settings.instruction_title }}</h5>
                  <p>{{ block.settings.instruction_text }}</p>
                </div>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    {%- endif -%}
    
    <!-- Fit Tips -->
    {%- if section.settings.show_tips and section.settings.tips_text != blank -%}
      <div class="size-guide-tips">
        <h5><i class="fa-solid fa-lightbulb"></i> {{ section.settings.tips_title | default: 'Fit Tips' }}</h5>
        <p>{{ section.settings.tips_text }}</p>
      </div>
    {%- endif -%}
    
  </div>
</div>

<script>
// ===== SIZE GUIDE SYSTEM =====
const SizeGuide = {
  modal: null,
  overlay: null,
  currentUnit: 'in',
  
  init() {
    this.modal = document.getElementById('size-guide-modal');
    this.overlay = document.getElementById('size-guide-overlay');
  },
  
  open() {
    if (!this.modal) this.init();
    this.modal.classList.add('active');
    this.overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
  },
  
  close() {
    if (!this.modal) return;
    this.modal.classList.remove('active');
    this.overlay.classList.remove('active');
    document.body.style.overflow = '';
  },
  
  toggleUnit(unit, btn) {
    if (this.currentUnit === unit) return;
    this.currentUnit = unit;
    
    // Update button states
    document.querySelectorAll('.size-unit-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    // Update table values
    const table = document.getElementById('size-guide-table');
    if (table) {
      table.querySelectorAll('td[data-in]').forEach(cell => {
        if (unit === 'cm') {
          cell.textContent = cell.getAttribute('data-cm') + ' cm';
        } else {
          cell.textContent = cell.getAttribute('data-in') + '"';
        }
      });
    }
  }
};

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  SizeGuide.init();
});

// Close on ESC key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    SizeGuide.close();
  }
});

// Click handler for triggers
document.addEventListener('click', function(e) {
  if (e.target.closest('.size-guide-trigger')) {
    e.preventDefault();
    SizeGuide.open();
  }
});
</script>

{% schema %}
{
  "name": "Size Guide",
  "tag": "section",
  "class": "section-size-guide",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Modal Title",
      "default": "Size Guide"
    },
    {
      "type": "header",
      "content": "Size Table"
    },
    {
      "type": "text",
      "id": "size_label",
      "label": "Size Column Label",
      "default": "Size"
    },
    {
      "type": "text",
      "id": "sizes",
      "label": "Sizes (comma-separated)",
      "default": "XS, S, M, L, XL, XXL",
      "info": "Enter sizes separated by commas"
    },
    {
      "type": "checkbox",
      "id": "show_unit_toggle",
      "label": "Show Unit Toggle (in/cm)",
      "default": true
    },
    {
      "type": "header",
      "content": "How to Measure"
    },
    {
      "type": "checkbox",
      "id": "show_how_to_measure",
      "label": "Show How to Measure Section",
      "default": true
    },
    {
      "type": "text",
      "id": "measure_title",
      "label": "Section Title",
      "default": "How to Measure"
    },
    {
      "type": "header",
      "content": "Fit Tips"
    },
    {
      "type": "checkbox",
      "id": "show_tips",
      "label": "Show Fit Tips",
      "default": true
    },
    {
      "type": "text",
      "id": "tips_title",
      "label": "Tips Title",
      "default": "Fit Tips"
    },
    {
      "type": "textarea",
      "id": "tips_text",
      "label": "Tips Text",
      "default": "For a relaxed fit, we recommend sizing up. If you're between sizes, choose the larger size for comfort or the smaller size for a more fitted look."
    },
    {
      "type": "header",
      "content": "⚙️ Gelişmiş"
    },
    {
      "type": "textarea",
      "id": "custom_css",
      "label": "Özel CSS",
      "info": "Bu section için özel CSS kodları ekleyin"
    }
  ],
  "blocks": [
    {
      "type": "measurement",
      "name": "Measurement Column",
      "settings": [
        {
          "type": "text",
          "id": "measurement_name",
          "label": "Measurement Name",
          "default": "Chest"
        },
        {
          "type": "text",
          "id": "values_in",
          "label": "Values (inches, comma-separated)",
          "default": "34, 36, 38, 40, 42, 44",
          "info": "Enter values for each size in order"
        },
        {
          "type": "text",
          "id": "values_cm",
          "label": "Values (cm, comma-separated)",
          "default": "86, 91, 97, 102, 107, 112",
          "info": "Enter values for each size in order"
        },
        {
          "type": "textarea",
          "id": "custom_css",
          "label": "Özel CSS (Block)",
          "info": "Bu block için özel CSS"
        }
      ]
    },
    {
      "type": "measure_instruction",
      "name": "Measure Instruction",
      "settings": [
        {
          "type": "text",
          "id": "instruction_title",
          "label": "Title",
          "default": "Chest"
        },
        {
          "type": "text",
          "id": "instruction_text",
          "label": "Instruction",
          "default": "Measure around the fullest part of your chest, keeping the tape horizontal."
        },
        {
          "type": "text",
          "id": "icon",
          "label": "Icon Class",
          "default": "fa-solid fa-ruler-horizontal",
          "info": "Font Awesome icon class"
        },
        {
          "type": "textarea",
          "id": "custom_css",
          "label": "Özel CSS (Block)",
          "info": "Bu block için özel CSS"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Size Guide",
      "blocks": [
        {
          "type": "measurement",
          "settings": {
            "measurement_name": "Chest",
            "values_in": "34, 36, 38, 40, 42, 44",
            "values_cm": "86, 91, 97, 102, 107, 112"
          }
        },
        {
          "type": "measurement",
          "settings": {
            "measurement_name": "Waist",
            "values_in": "28, 30, 32, 34, 36, 38",
            "values_cm": "71, 76, 81, 86, 91, 97"
          }
        },
        {
          "type": "measurement",
          "settings": {
            "measurement_name": "Length",
            "values_in": "26, 27, 28, 29, 30, 31",
            "values_cm": "66, 69, 71, 74, 76, 79"
          }
        },
        {
          "type": "measure_instruction",
          "settings": {
            "instruction_title": "Chest",
            "instruction_text": "Measure around the fullest part of your chest, keeping the tape horizontal.",
            "icon": "fa-solid fa-ruler-horizontal"
          }
        },
        {
          "type": "measure_instruction",
          "settings": {
            "instruction_title": "Waist",
            "instruction_text": "Measure around your natural waistline, keeping the tape comfortably loose.",
            "icon": "fa-solid fa-arrows-left-right"
          }
        },
        {
          "type": "measure_instruction",
          "settings": {
            "instruction_title": "Length",
            "instruction_text": "Measure from the highest point of the shoulder to the bottom hem.",
            "icon": "fa-solid fa-arrows-up-down"
          }
        }
      ]
    }
  ]
}
{% endschema %}
