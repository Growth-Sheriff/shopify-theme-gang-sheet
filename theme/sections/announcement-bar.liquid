{% comment %}
  ============================================
  ANNOUNCEMENT BAR SECTION
  Sliding/Static announcement bar with multiple messages
  ============================================
{% endcomment %}

{%- render 'custom-css-renderer', section: section -%}

<style>
/* ===== ANNOUNCEMENT BAR STYLES ===== */
.announcement-bar {
  background: linear-gradient(135deg, #7367f0, #9e95f5);
  padding: 10px 0;
  position: relative;
  overflow: hidden;
  z-index: 1000;
}

.announcement-bar.dark {
  background: #2d2d3a;
}

.announcement-bar.light {
  background: #fff;
  border-bottom: 1px solid #eee;
}

.announcement-bar.gradient-alt {
  background: linear-gradient(135deg, #28c76f, #48da89);
}

.announcement-bar.gradient-warning {
  background: linear-gradient(135deg, #ff9f43, #ffb976);
}

.announcement-bar-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 30px;
}

/* Single Message */
.announcement-message {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-size: 0.9rem;
  font-weight: 500;
  color: #fff;
  text-align: center;
}

.announcement-bar.light .announcement-message {
  color: #2d2d3a;
}

.announcement-message a {
  color: inherit;
  text-decoration: underline;
  text-underline-offset: 2px;
}

.announcement-message a:hover {
  opacity: 0.9;
}

.announcement-icon {
  font-size: 1rem;
}

/* Slider Messages */
.announcement-slider {
  position: relative;
  height: 22px;
  overflow: hidden;
  flex: 1;
  max-width: 800px;
}

.announcement-slide {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-size: 0.9rem;
  font-weight: 500;
  color: #fff;
  text-align: center;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.4s ease;
}

.announcement-slide.active {
  opacity: 1;
  transform: translateY(0);
}

.announcement-bar.light .announcement-slide {
  color: #2d2d3a;
}

/* Close Button */
.announcement-close {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.announcement-bar.light .announcement-close {
  background: rgba(0, 0, 0, 0.05);
}

.announcement-close:hover {
  background: rgba(255, 255, 255, 0.3);
}

.announcement-bar.light .announcement-close:hover {
  background: rgba(0, 0, 0, 0.1);
}

.announcement-close i {
  font-size: 0.75rem;
  color: #fff;
}

.announcement-bar.light .announcement-close i {
  color: #5d596c;
}

/* Navigation Dots */
.announcement-dots {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-left: 12px;
}

.announcement-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.4);
  cursor: pointer;
  transition: all 0.3s ease;
}

.announcement-dot.active {
  background: #fff;
  width: 18px;
  border-radius: 3px;
}

.announcement-bar.light .announcement-dot {
  background: rgba(0, 0, 0, 0.2);
}

.announcement-bar.light .announcement-dot.active {
  background: #7367f0;
}

/* Marquee style */
.announcement-marquee {
  display: flex;
  animation: marquee 25s linear infinite;
  white-space: nowrap;
}

.announcement-marquee-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 0 50px;
  font-size: 0.9rem;
  font-weight: 500;
  color: #fff;
}

.announcement-bar.light .announcement-marquee-item {
  color: #2d2d3a;
}

.announcement-marquee-separator {
  font-size: 0.6rem;
  opacity: 0.5;
}

@keyframes marquee {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-50%);
  }
}

/* ===== RESPONSIVE ===== */
@media (max-width: 767.98px) {
  .announcement-bar {
    padding: 8px 0;
  }
  
  .announcement-message,
  .announcement-slide,
  .announcement-marquee-item {
    font-size: 0.8rem;
  }
  
  .announcement-close {
    width: 24px;
    height: 24px;
  }
  
  .announcement-dots {
    display: none;
  }
}
</style>

{%- assign bar_hidden = false -%}

<section class="announcement-bar {{ section.settings.style }}" id="announcement-bar-{{ section.id }}" style="{% if bar_hidden %}display: none;{% endif %}">
  
  {%- if section.settings.display_type == 'slider' -%}
    <!-- Slider Mode -->
    <div class="announcement-bar-container">
      <div class="announcement-slider" id="announcement-slider-{{ section.id }}">
        {%- for block in section.blocks -%}
          <div class="announcement-slide {% if forloop.first %}active{% endif %}" {{ block.shopify_attributes }}>
            {%- if block.settings.icon != blank -%}
              <i class="{{ block.settings.icon }} announcement-icon"></i>
            {%- endif -%}
            <span>
              {%- if block.settings.link != blank -%}
                <a href="{{ block.settings.link }}">{{ block.settings.message }}</a>
              {%- else -%}
                {{ block.settings.message }}
              {%- endif -%}
            </span>
          </div>
        {%- endfor -%}
      </div>
      
      {%- if section.blocks.size > 1 -%}
        <div class="announcement-dots">
          {%- for block in section.blocks -%}
            <div class="announcement-dot {% if forloop.first %}active{% endif %}" data-slide="{{ forloop.index0 }}"></div>
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>
    
  {%- elsif section.settings.display_type == 'marquee' -%}
    <!-- Marquee Mode -->
    <div class="announcement-marquee-wrapper" style="overflow: hidden;">
      <div class="announcement-marquee">
        {%- for i in (1..2) -%}
          {%- for block in section.blocks -%}
            <div class="announcement-marquee-item">
              {%- if block.settings.icon != blank -%}
                <i class="{{ block.settings.icon }} announcement-icon"></i>
              {%- endif -%}
              <span>
                {%- if block.settings.link != blank -%}
                  <a href="{{ block.settings.link }}">{{ block.settings.message }}</a>
                {%- else -%}
                  {{ block.settings.message }}
                {%- endif -%}
              </span>
            </div>
            {%- unless forloop.last and i == 2 -%}
              <span class="announcement-marquee-separator">‚óè</span>
            {%- endunless -%}
          {%- endfor -%}
        {%- endfor -%}
      </div>
    </div>
    
  {%- else -%}
    <!-- Static Mode -->
    <div class="announcement-bar-container">
      {%- assign first_block = section.blocks.first -%}
      <div class="announcement-message">
        {%- if first_block.settings.icon != blank -%}
          <i class="{{ first_block.settings.icon }} announcement-icon"></i>
        {%- endif -%}
        <span>
          {%- if first_block.settings.link != blank -%}
            <a href="{{ first_block.settings.link }}">{{ first_block.settings.message }}</a>
          {%- else -%}
            {{ first_block.settings.message }}
          {%- endif -%}
        </span>
      </div>
    </div>
  {%- endif -%}
  
  {%- if section.settings.show_close -%}
    <button class="announcement-close" onclick="closeAnnouncementBar('{{ section.id }}')" aria-label="Close">
      <i class="fa-solid fa-times"></i>
    </button>
  {%- endif -%}
  
</section>

<script>
// Close announcement bar
function closeAnnouncementBar(sectionId) {
  const bar = document.getElementById('announcement-bar-' + sectionId);
  if (bar) {
    bar.style.display = 'none';
    // Remember closed state
    sessionStorage.setItem('announcement-closed-' + sectionId, 'true');
  }
}

// Check if should be hidden
document.addEventListener('DOMContentLoaded', function() {
  const sectionId = '{{ section.id }}';
  if (sessionStorage.getItem('announcement-closed-' + sectionId) === 'true') {
    const bar = document.getElementById('announcement-bar-' + sectionId);
    if (bar) bar.style.display = 'none';
  }
  
  // Slider functionality
  const slider = document.getElementById('announcement-slider-' + sectionId);
  if (slider) {
    const slides = slider.querySelectorAll('.announcement-slide');
    const dots = document.querySelectorAll('#announcement-bar-' + sectionId + ' .announcement-dot');
    let currentSlide = 0;
    const totalSlides = slides.length;
    
    if (totalSlides > 1) {
      // Auto-rotate
      setInterval(function() {
        currentSlide = (currentSlide + 1) % totalSlides;
        updateSlide();
      }, {{ section.settings.rotation_speed | default: 4000 }});
      
      // Dot click
      dots.forEach(function(dot, index) {
        dot.addEventListener('click', function() {
          currentSlide = index;
          updateSlide();
        });
      });
    }
    
    function updateSlide() {
      slides.forEach(function(slide, index) {
        slide.classList.toggle('active', index === currentSlide);
      });
      dots.forEach(function(dot, index) {
        dot.classList.toggle('active', index === currentSlide);
      });
    }
  }
});
</script>

{% schema %}
{
  "name": "Announcement Bar",
  "tag": "section",
  "class": "section-announcement-bar",
  "limit": 1,
  "settings": [
    {
      "type": "select",
      "id": "display_type",
      "label": "Display Type",
      "options": [
        { "value": "static", "label": "Static (single message)" },
        { "value": "slider", "label": "Slider (rotating)" },
        { "value": "marquee", "label": "Marquee (scrolling)" }
      ],
      "default": "slider"
    },
    {
      "type": "select",
      "id": "style",
      "label": "Color Style",
      "options": [
        { "value": "", "label": "Primary Gradient" },
        { "value": "dark", "label": "Dark" },
        { "value": "light", "label": "Light" },
        { "value": "gradient-alt", "label": "Success Gradient" },
        { "value": "gradient-warning", "label": "Warning Gradient" }
      ],
      "default": ""
    },
    {
      "type": "range",
      "id": "rotation_speed",
      "label": "Rotation Speed (ms)",
      "min": 2000,
      "max": 8000,
      "step": 500,
      "default": 4000,
      "info": "Only for slider mode"
    },
    {
      "type": "checkbox",
      "id": "show_close",
      "label": "Show Close Button",
      "default": true
    },
    {
      "type": "header",
      "content": "‚öôÔ∏è Geli≈ümi≈ü"
    },
    {
      "type": "textarea",
      "id": "custom_css",
      "label": "√ñzel CSS",
      "info": "Bu section i√ßin √∂zel CSS kodlarƒ± ekleyin"
    }
  ],
  "blocks": [
    {
      "type": "message",
      "name": "Message",
      "settings": [
        {
          "type": "text",
          "id": "message",
          "label": "Message",
          "default": "Free shipping on orders over $50!"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (optional)"
        },
        {
          "type": "text",
          "id": "icon",
          "label": "Icon Class (optional)",
          "default": "fa-solid fa-truck",
          "info": "Font Awesome icon class"
        },
        {
          "type": "textarea",
          "id": "custom_css",
          "label": "√ñzel CSS (Block)",
          "info": "Bu block i√ßin √∂zel CSS"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Announcement Bar",
      "blocks": [
        {
          "type": "message",
          "settings": {
            "message": "üöö Free shipping on orders over $50!",
            "icon": ""
          }
        },
        {
          "type": "message",
          "settings": {
            "message": "üéâ Use code SAVE20 for 20% off your first order",
            "icon": ""
          }
        },
        {
          "type": "message",
          "settings": {
            "message": "‚≠ê Over 10,000+ happy customers worldwide",
            "icon": ""
          }
        }
      ]
    }
  ]
}
{% endschema %}
