{% comment %}
  ============================================
  CART PAGE - Premium Clean Design
  ============================================
  Minimal, elegant cart - GÃ¶rsel 1 style
{% endcomment %}

{{ 'cart-premium.css' | asset_url | stylesheet_tag }}

<div class="premium-cart">
  <div class="cart-container">
    
    {%- comment -%} HEADER {%- endcomment -%}
    <header class="cart-header">
      <a href="{{ routes.all_products_collection_url }}" class="cart-back">
        <i class="ti ti-arrow-left"></i>
      </a>
      <h1 class="cart-title">My Cart</h1>
      <button type="button" class="cart-share" aria-label="Share">
        <i class="ti ti-share"></i>
      </button>
    </header>

    {%- if cart.item_count > 0 -%}

      {%- comment -%} DELIVERY BAR {%- endcomment -%}
      <div class="cart-delivery">
        <i class="ti ti-map-pin"></i>
        <span>Delivered to <strong>{{ customer.default_address.city | default: 'Your Location' }}</strong></span>
        <a href="#" class="edit-link">Edit</a>
      </div>

      <form action="{{ routes.cart_url }}" method="post" id="cartForm">
        


        {%- comment -%} CART ITEMS {%- endcomment -%}
        <div class="cart-items">
          {%- for item in cart.items -%}
          <div class="cart-item" data-key="{{ item.key }}">
            

            
            <a href="{{ item.url }}" class="item-img">
              {%- if item.image -%}
                <img src="{{ item.image | image_url: width: 150 }}" alt="{{ item.title }}" width="150" height="150" loading="lazy">
              {%- else -%}
                <div class="img-placeholder"><i class="ti ti-photo"></i></div>
              {%- endif -%}
            </a>
            
            <div class="item-info">
              <h3 class="item-name">{{ item.product.title }}</h3>
              <div class="item-price">
                {%- if item.original_price > item.final_price -%}
                  <span class="sale">{{ item.final_price | money }}</span>
                  <span class="original">{{ item.original_price | money }}</span>
                {%- else -%}
                  <span class="regular">{{ item.final_price | money }}</span>
                {%- endif -%}
              </div>
              {%- if item.variant.title != 'Default Title' -%}
                <span class="item-variant">{{ item.variant.title }}</span>
              {%- endif -%}
            </div>
            
            <div class="item-actions">
              <div class="item-qty">
                <button type="button" class="qty-btn minus" data-key="{{ item.key }}">
                  <i class="ti ti-minus"></i>
                </button>
                <input type="number" name="updates[{{ item.key }}]" value="{{ item.quantity }}" min="1" class="qty-input" data-key="{{ item.key }}">
                <button type="button" class="qty-btn plus" data-key="{{ item.key }}">
                  <i class="ti ti-plus"></i>
                </button>
              </div>
              <button type="button" class="item-remove" data-key="{{ item.key }}" aria-label="Remove">
                <i class="ti ti-trash"></i>
              </button>
            </div>
            
          </div>
          {%- endfor -%}
        </div>



        {%- comment -%} SUMMARY {%- endcomment -%}
        <div class="cart-summary">
          <div class="summary-row">
            <span>Subtotal</span>
            <span id="subtotal">{{ cart.total_price | money }}</span>
          </div>
          <div class="summary-row">
            <span>Delivery Fee</span>
            <span class="delivery-fee">
              {%- if cart.total_price >= 5000 -%}FREE{%- else -%}$5{%- endif -%}
            </span>
          </div>

          <div class="divider"></div>
          <div class="summary-row total">
            <span>Total Checkout</span>
            <span id="totalPrice">{{ cart.total_price | money }}</span>
          </div>
        </div>

        {%- comment -%} CHECKOUT {%- endcomment -%}
        <button type="submit" name="checkout" class="checkout-btn">
          Checkout Item
        </button>
        
      </form>

    {%- else -%}

      {%- comment -%} EMPTY {%- endcomment -%}
      <div class="cart-empty">
        <i class="ti ti-shopping-cart-off"></i>
        <h2>Your cart is empty</h2>
        <p>Add some items to get started</p>
        <a href="{{ routes.all_products_collection_url }}" class="shop-btn">Start Shopping</a>
      </div>

    {%- endif -%}

  </div>
</div>

{%- comment -%} MOBILE STICKY BAR {%- endcomment -%}
{%- if cart.item_count > 0 -%}
<div class="mobile-checkout-bar">
  <div class="bar-total">
    <span class="label">Total</span>
    <span class="value">{{ cart.total_price | money }}</span>
  </div>
  <button type="submit" form="cartForm" name="checkout" class="bar-btn">Checkout</button>
</div>
{%- endif -%}

<script>
(function(){
  const moneyFormat = {{ shop.money_format | json }};
  
  function formatMoney(cents) {
    const amount = (cents / 100).toFixed(2);
    return moneyFormat.replace(/\{\{\s*amount\s*\}\}/g, amount)
                      .replace(/\{\{\s*amount_no_decimals\s*\}\}/g, Math.round(cents/100))
                      .replace(/\{\{\s*amount_with_comma_separator\s*\}\}/g, amount.replace('.', ','));
  }
  
  // Quantity controls
  document.querySelectorAll('.qty-btn').forEach(btn => {
    btn.addEventListener('click', function(){
      const key = this.dataset.key;
      const input = document.querySelector(`.qty-input[data-key="${key}"]`);
      let val = parseInt(input.value) || 1;
      if(this.classList.contains('plus')) val++;
      else if(val > 1) val--;
      input.value = val;
      updateCart(key, val);
    });
  });
  
  // Remove item
  document.querySelectorAll('.item-remove').forEach(btn => {
    btn.addEventListener('click', function(){
      const key = this.dataset.key;
      updateCart(key, 0);
      this.closest('.cart-item').remove();
    });
  });
  
  function updateCart(key, qty){
    fetch('/cart/change.js', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({id: key, quantity: qty})
    }).then(r => r.json()).then(cart => {
      // Update prices
      document.getElementById('subtotal').textContent = formatMoney(cart.total_price);
      document.getElementById('totalPrice').textContent = formatMoney(cart.total_price);
      document.querySelectorAll('.bar-total .value').forEach(el => {
        el.textContent = formatMoney(cart.total_price);
      });
      // Update header badge
      document.querySelectorAll('.cart-count, .cart-badge, #drawerCount, #navCartBadge').forEach(el => {
        el.textContent = cart.item_count;
      });
      // Reload if empty
      if(cart.item_count === 0) location.reload();
    });
  }
  

})();
</script>
