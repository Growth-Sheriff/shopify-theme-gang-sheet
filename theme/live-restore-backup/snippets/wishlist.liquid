{% comment %}
  ============================================
  WISHLIST SNIPPET
  localStorage-based wishlist system
  Include in theme.liquid before </body>
  ============================================
{% endcomment %}

<style>
/* ===== WISHLIST HEART BUTTON ===== */
.wishlist-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: rgba(255,255,255,0.95);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  transition: all 0.3s ease;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.wishlist-btn:hover {
  transform: scale(1.1);
  background: #fff;
}

.wishlist-btn i {
  font-size: 1rem;
  color: #9a97a8;
  transition: all 0.3s ease;
}

.wishlist-btn.active i {
  color: #ea5455;
}

.wishlist-btn.active i::before {
  content: "\f004";
  font-weight: 900;
}

/* Wishlist Count Badge */
.wishlist-count-badge {
  position: absolute;
  top: -5px;
  right: -5px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #ea5455;
  color: #fff;
  font-size: 0.7rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
}

.wishlist-count-badge:empty,
.wishlist-count-badge[data-count="0"] {
  display: none;
}

/* ===== WISHLIST PAGE ===== */
.wishlist-page {
  padding: 40px 0 80px;
  min-height: 60vh;
}

.wishlist-header {
  text-align: center;
  margin-bottom: 40px;
}

.wishlist-header h1 {
  font-size: 2.2rem;
  font-weight: 700;
  color: #2d2d3a;
  margin: 0 0 10px 0;
}

.wishlist-header p {
  color: #6c757d;
  margin: 0;
}

.wishlist-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 24px;
}

.wishlist-item {
  background: #fff;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0,0,0,0.04);
  border: 1px solid rgba(115, 103, 240, 0.08);
  transition: all 0.3s ease;
  position: relative;
}

.wishlist-item:hover {
  box-shadow: 0 8px 30px rgba(115, 103, 240, 0.15);
  transform: translateY(-4px);
}

.wishlist-item-image {
  aspect-ratio: 1;
  overflow: hidden;
  position: relative;
}

.wishlist-item-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.4s ease;
}

.wishlist-item:hover .wishlist-item-image img {
  transform: scale(1.05);
}

.wishlist-remove {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: rgba(255,255,255,0.95);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  z-index: 5;
}

.wishlist-remove:hover {
  background: #ea5455;
  color: #fff;
}

.wishlist-remove i {
  font-size: 0.85rem;
  color: #9a97a8;
}

.wishlist-remove:hover i {
  color: #fff;
}

.wishlist-item-info {
  padding: 16px;
}

.wishlist-item-title {
  font-size: 0.95rem;
  font-weight: 600;
  color: #2d2d3a;
  margin: 0 0 8px 0;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.wishlist-item-title a {
  color: inherit;
  text-decoration: none;
}

.wishlist-item-title a:hover {
  color: #7367f0;
}

.wishlist-item-price {
  font-size: 1.1rem;
  font-weight: 700;
  color: #7367f0;
  margin: 0 0 12px 0;
}

.wishlist-item-price s {
  color: #9a97a8;
  font-size: 0.9rem;
  font-weight: 400;
  margin-left: 8px;
}

.wishlist-add-cart {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #7367f0, #9e95f5);
  border: none;
  border-radius: 10px;
  color: #fff;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.wishlist-add-cart:hover {
  box-shadow: 0 4px 15px rgba(115, 103, 240, 0.4);
}

/* Empty Wishlist */
.wishlist-empty {
  text-align: center;
  padding: 60px 20px;
}

.wishlist-empty-icon {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: rgba(115, 103, 240, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 24px;
}

.wishlist-empty-icon i {
  font-size: 2.5rem;
  color: #7367f0;
}

.wishlist-empty h3 {
  font-size: 1.4rem;
  font-weight: 600;
  color: #2d2d3a;
  margin: 0 0 10px 0;
}

.wishlist-empty p {
  color: #6c757d;
  margin: 0 0 24px 0;
}

.wishlist-empty-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 14px 28px;
  background: linear-gradient(135deg, #7367f0, #9e95f5);
  border-radius: 12px;
  color: #fff;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.3s ease;
}

.wishlist-empty-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(115, 103, 240, 0.35);
}

/* Toast Notification */
.wishlist-toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: #2d2d3a;
  color: #fff;
  padding: 14px 24px;
  border-radius: 12px;
  font-size: 0.9rem;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 9999;
  opacity: 0;
  transition: all 0.3s ease;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.wishlist-toast.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.wishlist-toast.success {
  background: #28c76f;
}

.wishlist-toast.removed {
  background: #ea5455;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 991.98px) {
  .wishlist-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }
}

@media (max-width: 767.98px) {
  .wishlist-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }
  
  .wishlist-header h1 {
    font-size: 1.6rem;
  }
  
  .wishlist-item-info {
    padding: 12px;
  }
  
  .wishlist-item-title {
    font-size: 0.85rem;
  }
  
  .wishlist-item-price {
    font-size: 0.95rem;
  }
}
</style>

<!-- Toast Notification Container -->
<div id="wishlist-toast" class="wishlist-toast">
  <i class="fa-solid fa-heart"></i>
  <span id="wishlist-toast-message"></span>
</div>

<script>
// ===== WISHLIST SYSTEM =====
const WishlistSystem = {
  storageKey: 'shopify_wishlist',
  
  // Get wishlist from localStorage
  getWishlist() {
    const data = localStorage.getItem(this.storageKey);
    return data ? JSON.parse(data) : [];
  },
  
  // Save wishlist to localStorage
  saveWishlist(wishlist) {
    localStorage.setItem(this.storageKey, JSON.stringify(wishlist));
    this.updateAllButtons();
    this.updateCount();
  },
  
  // Add item to wishlist
  add(productId, productHandle, productTitle, productImage, productPrice, productComparePrice) {
    const wishlist = this.getWishlist();
    
    if (!wishlist.find(item => item.id === productId)) {
      wishlist.push({
        id: productId,
        handle: productHandle,
        title: productTitle,
        image: productImage,
        price: productPrice,
        comparePrice: productComparePrice,
        addedAt: new Date().toISOString()
      });
      
      this.saveWishlist(wishlist);
      this.showToast('Added to wishlist!', 'success');
      return true;
    }
    return false;
  },
  
  // Remove item from wishlist
  remove(productId) {
    let wishlist = this.getWishlist();
    wishlist = wishlist.filter(item => item.id !== productId);
    this.saveWishlist(wishlist);
    this.showToast('Removed from wishlist', 'removed');
  },
  
  // Toggle item in wishlist
  toggle(productId, productHandle, productTitle, productImage, productPrice, productComparePrice) {
    if (this.isInWishlist(productId)) {
      this.remove(productId);
      return false;
    } else {
      this.add(productId, productHandle, productTitle, productImage, productPrice, productComparePrice);
      return true;
    }
  },
  
  // Check if item is in wishlist
  isInWishlist(productId) {
    return this.getWishlist().some(item => item.id === productId);
  },
  
  // Get wishlist count
  getCount() {
    return this.getWishlist().length;
  },
  
  // Update count badges
  updateCount() {
    const count = this.getCount();
    document.querySelectorAll('.wishlist-count').forEach(el => {
      el.textContent = count;
      el.setAttribute('data-count', count);
    });
  },
  
  // Update all wishlist buttons state
  updateAllButtons() {
    document.querySelectorAll('.wishlist-btn[data-product-id]').forEach(btn => {
      const productId = parseInt(btn.getAttribute('data-product-id'));
      if (this.isInWishlist(productId)) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
  },
  
  // Show toast notification
  showToast(message, type = 'success') {
    const toast = document.getElementById('wishlist-toast');
    const messageEl = document.getElementById('wishlist-toast-message');
    
    if (toast && messageEl) {
      messageEl.textContent = message;
      toast.className = 'wishlist-toast ' + type;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
  },
  
  // Clear all wishlist
  clear() {
    localStorage.removeItem(this.storageKey);
    this.updateAllButtons();
    this.updateCount();
  },
  
  // Render wishlist page
  renderWishlistPage(containerId) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    const wishlist = this.getWishlist();
    
    if (wishlist.length === 0) {
      container.innerHTML = `
        <div class="wishlist-empty">
          <div class="wishlist-empty-icon">
            <i class="fa-regular fa-heart"></i>
          </div>
          <h3>Your wishlist is empty</h3>
          <p>Start adding products you love to your wishlist</p>
          <a href="/collections/all" class="wishlist-empty-btn">
            <i class="fa-solid fa-shopping-bag"></i>
            Browse Products
          </a>
        </div>
      `;
      return;
    }
    
    let html = '<div class="wishlist-grid">';
    
    wishlist.forEach(item => {
      html += `
        <div class="wishlist-item" data-product-id="${item.id}">
          <div class="wishlist-item-image">
            <a href="/products/${item.handle}">
              <img src="${item.image}" alt="${item.title}" loading="lazy">
            </a>
            <button class="wishlist-remove" onclick="WishlistSystem.removeAndRender(${item.id}, '${containerId}')">
              <i class="fa-solid fa-times"></i>
            </button>
          </div>
          <div class="wishlist-item-info">
            <h3 class="wishlist-item-title">
              <a href="/products/${item.handle}">${item.title}</a>
            </h3>
            <p class="wishlist-item-price">
              ${item.price}
              ${item.comparePrice ? `<s>${item.comparePrice}</s>` : ''}
            </p>
            <a href="/products/${item.handle}" class="wishlist-add-cart">
              <i class="fa-solid fa-eye"></i> View Product
            </a>
          </div>
        </div>
      `;
    });
    
    html += '</div>';
    container.innerHTML = html;
  },
  
  // Remove and re-render wishlist page
  removeAndRender(productId, containerId) {
    this.remove(productId);
    this.renderWishlistPage(containerId);
  }
};

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  WishlistSystem.updateAllButtons();
  WishlistSystem.updateCount();
  
  // If on wishlist page, render it
  const wishlistContainer = document.getElementById('wishlist-items');
  if (wishlistContainer) {
    WishlistSystem.renderWishlistPage('wishlist-items');
  }
});

// Cross-tab sync: Listen for storage changes from other tabs
window.addEventListener('storage', function(e) {
  if (e.key === WishlistSystem.storageKey) {
    // Another tab updated wishlist, sync this tab
    WishlistSystem.updateAllButtons();
    WishlistSystem.updateCount();
    
    // Re-render wishlist page if on it
    const wishlistContainer = document.getElementById('wishlist-items');
    if (wishlistContainer) {
      WishlistSystem.renderWishlistPage('wishlist-items');
    }
  }
});

// Click handler for wishlist buttons
document.addEventListener('click', function(e) {
  const btn = e.target.closest('.wishlist-btn[data-product-id]');
  if (btn) {
    e.preventDefault();
    const productId = parseInt(btn.getAttribute('data-product-id'));
    const productHandle = btn.getAttribute('data-product-handle');
    const productTitle = btn.getAttribute('data-product-title');
    const productImage = btn.getAttribute('data-product-image');
    const productPrice = btn.getAttribute('data-product-price');
    const productComparePrice = btn.getAttribute('data-product-compare-price') || '';
    
    WishlistSystem.toggle(productId, productHandle, productTitle, productImage, productPrice, productComparePrice);
  }
});
</script>
