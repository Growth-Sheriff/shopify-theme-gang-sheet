{% comment %}
  Collection Products Grid - Modern Vuexy Design
{% endcomment %}

{% paginate collection.products by section.settings.products_per_page %}
<section class="collection-products-section">
  <div class="container">
    
    <!-- Filter & Sort Bar -->
    <div class="products-toolbar">
      <div class="toolbar-left">
        <span class="results-count">
          <i class="fa-solid fa-box-open"></i>
          Showing <strong>{{ collection.products.size }}</strong> of <strong>{{ collection.products_count }}</strong> products
        </span>
      </div>
      
      <div class="toolbar-right">
        <!-- View Toggle -->
        <div class="view-toggle">
          <button class="view-btn active" data-view="grid" title="Grid View">
            <i class="fa-solid fa-grid-2"></i>
          </button>
          <button class="view-btn" data-view="list" title="List View">
            <i class="fa-solid fa-list"></i>
          </button>
        </div>
        
        <!-- Sort Dropdown -->
        <div class="sort-wrapper">
          <label for="sort-select-{{ section.id }}">
            <i class="fa-solid fa-arrow-up-arrow-down"></i>
            Sort:
          </label>
          <select id="sort-select-{{ section.id }}" class="sort-select" onchange="window.location.href = this.value;">
            {% for option in collection.sort_options %}
              <option value="{{ collection.url }}?sort_by={{ option.value }}" {% if collection.sort_by == option.value %}selected{% endif %}>
                {{ option.name }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>
    
    <!-- Products Grid -->
    {% if collection.products.size > 0 %}
    <div class="products-grid cols-{{ section.settings.columns_desktop }}" id="productsGrid-{{ section.id }}">
      {% for product in collection.products %}
        <article class="product-card" data-product-id="{{ product.id }}">
          <!-- Product Image -->
          <a href="{{ product.url }}" class="product-image-link">
            <div class="product-image-wrapper">
              {% if product.featured_image %}
                <img 
                  src="{{ product.featured_image | image_url: width: 600 }}" 
                  alt="{{ product.title | escape }}"
                  width="600"
                  height="600"
                  loading="lazy"
                  class="product-image primary"
                >
                {% if product.images.size > 1 and section.settings.show_second_image %}
                  <img 
                    src="{{ product.images[1] | image_url: width: 600 }}" 
                    alt="{{ product.title | escape }}"
                    width="600"
                    height="600"
                    loading="lazy"
                    class="product-image secondary"
                  >
                {% endif %}
              {% else %}
                <div class="product-placeholder">
                  <i class="fa-solid fa-image"></i>
                </div>
              {% endif %}
              
              <!-- Badges -->
              <div class="product-badges">
                {% if product.compare_at_price > product.price %}
                  {% assign discount = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price %}
                  <span class="badge badge-sale">-{{ discount }}%</span>
                {% endif %}
                {% unless product.available %}
                  <span class="badge badge-soldout">Sold Out</span>
                {% endunless %}
              </div>
              
              <!-- Quick Actions -->
              <div class="quick-actions">
                <button class="action-btn wishlist-btn" title="Add to Wishlist">
                  <i class="fa-regular fa-heart"></i>
                </button>
                <button class="action-btn quickview-btn" title="Quick View" data-product-handle="{{ product.handle }}">
                  <i class="fa-regular fa-eye"></i>
                </button>
                <button class="action-btn compare-btn" title="Compare">
                  <i class="fa-solid fa-arrows-rotate"></i>
                </button>
              </div>
              
              <!-- Hover Overlay -->
              <div class="image-overlay"></div>
            </div>
          </a>
          
          <!-- Product Info -->
          <div class="product-info">
            <!-- Vendor -->
            {% if section.settings.show_vendor and product.vendor != blank %}
              <span class="product-vendor">{{ product.vendor }}</span>
            {% endif %}
            
            <!-- Title -->
            <h3 class="product-title">
              <a href="{{ product.url }}">{{ product.title }}</a>
            </h3>
            
            <!-- Rating -->
            {% if section.settings.show_rating %}
            <div class="product-rating">
              {% assign rating = product.metafields.reviews.rating.value | default: 5 | round %}
              <div class="stars">
                {% for i in (1..5) %}
                  {% if i <= rating %}
                    <i class="fa-solid fa-star"></i>
                  {% else %}
                    <i class="fa-regular fa-star"></i>
                  {% endif %}
                {% endfor %}
              </div>
              <span class="rating-count">({{ product.metafields.reviews.rating_count | default: 0 }})</span>
            </div>
            {% endif %}
            
            <!-- Price -->
            <div class="product-price">
              {% if product.compare_at_price > product.price %}
                <span class="price-compare">{{ product.compare_at_price | money }}</span>
              {% endif %}
              <span class="price-current">{{ product.price | money }}</span>
            </div>
            
            <!-- Variants Info -->
            {% if product.variants.size > 1 %}
            <div class="product-variants-info">
              <span class="variants-count">
                <i class="fa-solid fa-palette"></i>
                {{ product.variants.size }} options
              </span>
            </div>
            {% endif %}
          </div>
          
          <!-- Quick Add -->
          {% if section.settings.show_quick_add %}
          <div class="product-actions">
            {% if product.available %}
              {% if product.variants.size == 1 %}
                <button class="sb-btn add-to-cart-btn" data-variant-id="{{ product.first_available_variant.id }}">
                  <i class="fa-solid fa-cart-plus"></i>
                  <span>Add to Cart</span>
                </button>
              {% else %}
                <a href="{{ product.url }}" class="select-options-btn">
                  <i class="fa-solid fa-sliders"></i>
                  <span>Select Options</span>
                </a>
              {% endif %}
            {% else %}
              <button class="sb-btn sb-sold-out" disabled>
                <i class="fa-solid fa-ban"></i>
                <span>Sold Out</span>
              </button>
            {% endif %}
          </div>
          {% endif %}
        </article>
      {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="empty-collection">
      <div class="empty-icon">
        <i class="fa-solid fa-box-open"></i>
      </div>
      <h3>No Products Found</h3>
      <p>This collection doesn't have any products yet.</p>
      <a href="{{ routes.collections_url }}" class="browse-btn">
        <i class="fa-solid fa-arrow-left"></i>
        Browse Collections
      </a>
    </div>
    {% endif %}
    
    <!-- Pagination -->
    {% if paginate.pages > 1 %}
    <nav class="pagination" aria-label="Pagination">
      <div class="pagination-inner">
        {% if paginate.previous %}
          <a href="{{ paginate.previous.url }}" class="page-btn page-prev">
            <i class="fa-solid fa-chevron-left"></i>
            <span>Previous</span>
          </a>
        {% endif %}
        
        <div class="page-numbers">
          {% for part in paginate.parts %}
            {% if part.is_link %}
              <a href="{{ part.url }}" class="page-num">{{ part.title }}</a>
            {% else %}
              {% if part.title == paginate.current_page %}
                <span class="page-num current">{{ part.title }}</span>
              {% else %}
                <span class="page-num ellipsis">{{ part.title }}</span>
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>
        
        {% if paginate.next %}
          <a href="{{ paginate.next.url }}" class="page-btn page-next">
            <span>Next</span>
            <i class="fa-solid fa-chevron-right"></i>
          </a>
        {% endif %}
      </div>
    </nav>
    {% endif %}
    
  </div>
</section>
{% endpaginate %}

<style>
.collection-products-section {
  padding: 40px 0 80px;
  background: #f8f9fa;
}

.collection-products-section .container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 20px;
}

/* Toolbar */
.products-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 20px;
  background: #fff;
  padding: 16px 24px;
  border-radius: 16px;
  margin-bottom: 30px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
  flex-wrap: wrap;
}

.toolbar-left {
  display: flex;
  align-items: center;
}

.results-count {
  font-size: 0.9rem;
  color: #6c757d;
  display: flex;
  align-items: center;
  gap: 8px;
}

.results-count i {
  color: #667eea;
}

.results-count strong {
  color: #1a1a2e;
}

.toolbar-right {
  display: flex;
  align-items: center;
  gap: 20px;
}

/* View Toggle */
.view-toggle {
  display: flex;
  gap: 4px;
  background: #f8f9fa;
  padding: 4px;
  border-radius: 10px;
}

.view-btn {
  width: 38px;
  height: 38px;
  border: none;
  border-radius: 8px;
  background: transparent;
  color: #6c757d;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.view-btn:hover {
  color: #667eea;
}

.view-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

/* Sort */
.sort-wrapper {
  display: flex;
  align-items: center;
  gap: 10px;
}

.sort-wrapper label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.875rem;
  color: #6c757d;
}

.sort-wrapper label i {
  color: #667eea;
}

.sort-select {
  padding: 10px 36px 10px 16px;
  border: 2px solid #e9ecef;
  border-radius: 10px;
  font-size: 0.875rem;
  color: #1a1a2e;
  background: #fff;
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  transition: all 0.3s ease;
}

.sort-select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
}

/* Products Grid */
.products-grid {
  display: grid;
  gap: 24px;
}

.products-grid.cols-2 { grid-template-columns: repeat(2, 1fr); }
.products-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
.products-grid.cols-4 { grid-template-columns: repeat(4, 1fr); }
.products-grid.cols-5 { grid-template-columns: repeat(5, 1fr); }

/* Product Card */
.product-card {
  background: #fff;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
  transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
  position: relative;
}

.product-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 50px rgba(102, 126, 234, 0.15);
}

/* Product Image */
.product-image-link {
  display: block;
  text-decoration: none;
}

.product-image-wrapper {
  position: relative;
  aspect-ratio: 1;
  overflow: hidden;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.product-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: all 0.5s ease;
}

.product-image.secondary {
  position: absolute;
  inset: 0;
  opacity: 0;
}

.product-card:hover .product-image.primary {
  opacity: 0;
  transform: scale(1.05);
}

.product-card:hover .product-image.secondary {
  opacity: 1;
  transform: scale(1.05);
}

.product-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #dee2e6;
  font-size: 3rem;
}

/* Badges */
.product-badges {
  position: absolute;
  top: 12px;
  left: 12px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  z-index: 5;
}

.badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

.badge-sale {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
  color: #fff;
  box-shadow: 0 4px 12px rgba(238, 90, 90, 0.3);
}

.badge-soldout {
  background: #6c757d;
  color: #fff;
}

.badge-new {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
}

/* Quick Actions */
.quick-actions {
  position: absolute;
  top: 12px;
  right: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  opacity: 0;
  transform: translateX(10px);
  transition: all 0.3s ease;
  z-index: 5;
}

.product-card:hover .quick-actions {
  opacity: 1;
  transform: translateX(0);
}

.action-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  background: #fff;
  color: #1a1a2e;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

.action-btn:hover {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  transform: scale(1.1);
}

.action-btn.wishlist-btn:hover {
  background: #ff6b6b;
}

/* Image Overlay */
.image-overlay {
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.3) 0%, transparent 50%);
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

.product-card:hover .image-overlay {
  opacity: 1;
}

/* Product Info */
.product-info {
  padding: 20px;
  text-align: center;
}

.product-vendor {
  display: block;
  font-size: 0.75rem;
  color: #667eea;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 6px;
}

.product-title {
  margin: 0 0 10px 0;
}

.product-title a {
  font-size: 0.95rem;
  font-weight: 600;
  color: #1a1a2e;
  text-decoration: none;
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  transition: color 0.3s ease;
}

.product-title a:hover {
  color: #667eea;
}

/* Rating */
.product-rating {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-bottom: 10px;
}

.product-rating .stars {
  display: flex;
  gap: 2px;
}

.product-rating .stars i {
  font-size: 0.75rem;
  color: #ffc107;
}

.product-rating .rating-count {
  font-size: 0.75rem;
  color: #6c757d;
}

/* Price */
.product-price {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 8px;
}

.price-compare {
  font-size: 0.9rem;
  color: #adb5bd;
  text-decoration: line-through;
}

.price-current {
  font-size: 1.15rem;
  font-weight: 700;
  color: #1a1a2e;
}

/* Variants Info */
.product-variants-info {
  margin-bottom: 8px;
}

.variants-count {
  font-size: 0.75rem;
  color: #6c757d;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.variants-count i {
  color: #667eea;
}

/* Product Actions */
.product-actions {
  padding: 0 20px 20px;
}

.add-to-cart-btn,
.select-options-btn,
.sold-out-btn {
  width: 100%;
  padding: 12px 20px;
  border: none;
  border-radius: 12px;
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: all 0.3s ease;
  text-decoration: none;
}

.add-to-cart-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.add-to-cart-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

.add-to-cart-btn.success {
  background: linear-gradient(135deg, #28c76f 0%, #1e9d58 100%);
}

.select-options-btn {
  background: #1a1a2e;
  color: #fff;
}

.select-options-btn:hover {
  background: #2d2d44;
  transform: translateY(-2px);
}

.sold-out-btn {
  background: #e9ecef;
  color: #6c757d;
  cursor: not-allowed;
}

/* Empty State */
.empty-collection {
  text-align: center;
  padding: 80px 20px;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
}

.empty-icon {
  width: 100px;
  height: 100px;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 24px;
}

.empty-icon i {
  font-size: 2.5rem;
  color: #667eea;
}

.empty-collection h3 {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1a1a2e;
  margin: 0 0 12px;
}

.empty-collection p {
  font-size: 1rem;
  color: #6c757d;
  margin: 0 0 24px;
}

.browse-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  padding: 14px 28px;
  border-radius: 12px;
  text-decoration: none;
  font-weight: 600;
  transition: all 0.3s ease;
}

.browse-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
}

/* Pagination */
.pagination {
  margin-top: 50px;
}

.pagination-inner {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  flex-wrap: wrap;
}

.page-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  background: #fff;
  border: 2px solid #e9ecef;
  border-radius: 12px;
  color: #1a1a2e;
  text-decoration: none;
  font-weight: 600;
  font-size: 0.875rem;
  transition: all 0.3s ease;
}

.page-btn:hover {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: transparent;
  color: #fff;
  transform: translateY(-2px);
}

.page-numbers {
  display: flex;
  align-items: center;
  gap: 6px;
}

.page-num {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  font-size: 0.9rem;
  font-weight: 500;
  color: #6c757d;
  text-decoration: none;
  background: #fff;
  border: 2px solid transparent;
  transition: all 0.3s ease;
}

.page-num:hover {
  border-color: #667eea;
  color: #667eea;
}

.page-num.current {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  font-weight: 700;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

/* Responsive */
@media (max-width: 1200px) {
  .products-grid.cols-5 { grid-template-columns: repeat(4, 1fr); }
}

@media (max-width: 992px) {
  .products-grid.cols-4,
  .products-grid.cols-5 { grid-template-columns: repeat(3, 1fr); }
}

@media (max-width: 768px) {
  .collection-products-section { padding: 30px 0 60px; }
  
  .products-toolbar {
    flex-direction: column;
    align-items: stretch;
    gap: 16px;
  }
  
  .toolbar-right {
    justify-content: space-between;
  }
  
  .products-grid.cols-3,
  .products-grid.cols-4,
  .products-grid.cols-5 { grid-template-columns: repeat(2, 1fr); }
  
  .products-grid { gap: 16px; }
  
  .product-info { padding: 16px; }
  .product-actions { padding: 0 16px 16px; }
}

@media (max-width: 480px) {
  .products-grid.cols-2,
  .products-grid.cols-3,
  .products-grid.cols-4,
  .products-grid.cols-5 { grid-template-columns: 1fr; }
  
  .page-numbers { display: none; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add to Cart AJAX
  document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      e.preventDefault();
      const variantId = btn.dataset.variantId;
      if (!variantId) return;
      
      btn.disabled = true;
      const originalHTML = btn.innerHTML;
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Adding...';
      
      try {
        const res = await fetch('/cart/add.js', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: variantId, quantity: 1 })
        });
        
        if (res.ok) {
          btn.innerHTML = '<i class="fa-solid fa-check"></i> Added!';
          btn.classList.add('success');
          
          // Update cart count
          const cartRes = await fetch('/cart.js');
          const cart = await cartRes.json();
          document.querySelectorAll('.cart-count').forEach(el => el.textContent = cart.item_count);
          
          setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('success');
            btn.disabled = false;
          }, 2000);
        }
      } catch (err) {
        btn.innerHTML = '<i class="fa-solid fa-times"></i> Error';
        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.disabled = false;
        }, 2000);
      }
    });
  });
  
  // View Toggle
  const viewBtns = document.querySelectorAll('.view-btn');
  const grid = document.querySelector('.products-grid');
  
  viewBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      viewBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      if (btn.dataset.view === 'list' && grid) {
        grid.classList.add('list-view');
      } else if (grid) {
        grid.classList.remove('list-view');
      }
    });
  });
});
</script>

{% schema %}
{
  "name": "Collection Products",
  "tag": "section",
  "class": "collection-products-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Grid Layout"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per Page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 12
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Columns (Desktop)",
      "options": [
        { "value": "2", "label": "2 Columns" },
        { "value": "3", "label": "3 Columns" },
        { "value": "4", "label": "4 Columns" },
        { "value": "5", "label": "5 Columns" }
      ],
      "default": "4"
    },
    {
      "type": "header",
      "content": "Product Card"
    },
    {
      "type": "checkbox",
      "id": "show_second_image",
      "label": "Show Second Image on Hover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show Rating",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_quick_add",
      "label": "Show Quick Add Button",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Collection Products"
    }
  ]
}
{% endschema %}


