{% comment %}
  Product Info Card Section - CloudyPrints
  √úr√ºn bilgisi, fiyat, rating ve sepete ekle kartƒ±
{% endcomment %}

{{ 'product-page.css' | asset_url | stylesheet_tag }}

<div class="product-info-card" {{ section.shopify_attributes }}>
  {% comment %} Vendor/Category {% endcomment %}
  {% if product.vendor %}
    <span class="product-vendor">{{ product.vendor }}</span>
  {% endif %}

  {% comment %} Product Title {% endcomment %}
  <h1 class="product-title">{{ product.title }}</h1>

  {% comment %} Rating Section {% endcomment %}
  {% if section.settings.show_rating %}
  <div class="rating-section mb-3">
    <div class="rating-stars">
      <i class="ti ti-star-filled"></i>
      <i class="ti ti-star-filled"></i>
      <i class="ti ti-star-filled"></i>
      <i class="ti ti-star-filled"></i>
      <i class="ti ti-star-half-filled"></i>
    </div>
    <span class="rating-count">{{ section.settings.rating_score | default: '4.8' }} ({{ section.settings.review_count | default: '2,847' }} reviews)</span>
    <span class="cloudy-badge badge-success ms-2">
      <i class="ti ti-thumb-up me-1"></i>{{ section.settings.recommend_percent | default: '99%' }} recommend
    </span>
  </div>
  {% endif %}

  {% comment %} Price Box {% endcomment %}
  <div class="product-price-box">
    {% if section.settings.price_badge != blank %}
      <span class="price-badge">{{ section.settings.price_badge }}</span>
    {% endif %}
    <div class="price-row">
      <span class="current-price">{{ product.price | money }}</span>
      {% if product.compare_at_price > product.price %}
        <span class="compare-price">{{ product.compare_at_price | money }}</span>
        <span class="save-badge">Save {{ product.compare_at_price | minus: product.price | money }}</span>
      {% endif %}
    </div>
  </div>

  {% comment %} Variant Options (Size, Color, etc.) {% endcomment %}
  {% assign size_is_dropdown = false %}
  {% if product.has_only_default_variant == false %}
    {% for option in product.options_with_values %}
      {% assign option_name_lower = option.name | downcase %}
      {% assign is_size_option = false %}
      {% if option_name_lower == 'size' or option_name_lower == 'beden' %}
        {% assign is_size_option = true %}
      {% endif %}
      
      {% if is_size_option and section.settings.size_display_type == 'dropdown' %}
        {% assign size_is_dropdown = true %}
        {% comment %} Size Dropdown + Quantity - Same Row {% endcomment %}
        <div class="size-quantity-row">
          <div class="size-dropdown-col">
            <label class="variant-label">{{ option.name }}</label>
            <div class="variant-dropdown-wrapper">
              <select class="variant-select variant-select-full" 
                      data-option-name="{{ option.name }}"
                      onchange="selectVariantFromDropdown('{{ option.name }}', this.value)">
                {% for value in option.values %}
                  {% assign option_disabled = false %}
                  {% assign variant_for_value = product.variants | where: option.name, value | first %}
                  {% if variant_for_value and variant_for_value.available == false %}
                    {% assign option_disabled = true %}
                  {% endif %}
                  <option value="{{ value }}" 
                          {% if option.selected_value == value %}selected{% endif %}
                          {% if option_disabled %}disabled{% endif %}>
                    {{ value }}{% if option_disabled %} - Sold Out{% endif %}
                  </option>
                {% endfor %}
              </select>
              <i class="ti ti-chevron-down variant-select-icon"></i>
            </div>
          </div>
          <div class="quantity-col">
            <label class="quantity-label">Quantity</label>
            <div class="quantity-control">
              <button type="button" class="qty-btn" onclick="changeQuantity(-1)">
                <i class="ti ti-minus"></i>
              </button>
              <input type="number" id="productQuantity" name="quantity" value="1" min="1" max="999" class="qty-input">
              <button type="button" class="qty-btn" onclick="changeQuantity(1)">
                <i class="ti ti-plus"></i>
              </button>
            </div>
          </div>
        </div>
      {% else %}
        {% comment %} Button Style - Normal {% endcomment %}
        <div class="variant-option-section">
          <label class="variant-label">{{ option.name }}</label>
          <div class="variant-options">
            {% for value in option.values %}
              {% assign option_disabled = false %}
              {% assign variant_for_value = product.variants | where: option.name, value | first %}
              {% if variant_for_value and variant_for_value.available == false %}
                {% assign option_disabled = true %}
              {% endif %}
              <button type="button" 
                      class="variant-btn {% if option.selected_value == value %}active{% endif %} {% if option_disabled %}disabled{% endif %}"
                      data-option-name="{{ option.name }}"
                      data-option-value="{{ value }}"
                      onclick="selectVariantOption('{{ option.name }}', '{{ value }}', this)"
                      {% if option_disabled %}disabled{% endif %}>
                {{ value }}
              </button>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}

  {% comment %} Delivery Card {% endcomment %}
  {% if section.settings.show_delivery %}
  <div class="delivery-card-green">
    <div class="delivery-icon">
      <i class="ti ti-truck-delivery"></i>
    </div>
    <div class="delivery-content">
      <span class="delivery-title">Free Delivery</span>
      <span class="delivery-time">{{ section.settings.delivery_time | default: 'Tomorrow 5PM ‚Äì 9PM' }}</span>
      <span class="delivery-order-by">{{ section.settings.order_by | default: 'Order by 3PM' }}</span>
    </div>
  </div>
  {% endif %}

  {% comment %} Quantity Selector - Only show if Size is NOT dropdown {% endcomment %}
  {% unless size_is_dropdown %}
  <div class="quantity-section">
    <label class="quantity-label">Quantity</label>
    <div class="quantity-control">
      <button type="button" class="qty-btn" onclick="changeQuantity(-1)">
        <i class="ti ti-minus"></i>
      </button>
      <input type="number" id="productQuantity" name="quantity" value="1" min="1" max="999" class="qty-input">
      <button type="button" class="qty-btn" onclick="changeQuantity(1)">
        <i class="ti ti-plus"></i>
      </button>
    </div>
  </div>
  {% endunless %}

  {% comment %} Add to Cart {% endcomment %}
  <form method="post" action="{{ routes.cart_add_url }}" id="product-form-{{ product.id }}" class="product-form">
    <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" id="selectedVariant">
    <input type="hidden" name="quantity" value="1" id="cartQuantity">
    
    <button type="submit" class="sb-btn add-to-cart-btn" {% unless product.available %}disabled{% endunless %}>
      <i class="ti ti-shopping-cart me-2"></i>
      {% if product.available %}
        Add to Cart - <span id="cartBtnPrice">{{ product.price | money }}</span>
      {% else %}
        Sold Out
      {% endif %}
    </button>
  </form>

  {% comment %} Buy Now {% endcomment %}
  <button type="button" class="buy-now-btn" {% unless product.available %}disabled{% endunless %}>
    <i class="ti ti-bolt me-2"></i>Buy Now
  </button>

  {% comment %} Trust Badges {% endcomment %}
  <div class="trust-badges">
    <div class="trust-badge">
      <i class="ti ti-shield-check"></i>
      <span>{{ section.settings.badge_1 | default: 'Secure Checkout' }}</span>
    </div>
    <div class="trust-badge">
      <i class="ti ti-truck"></i>
      <span>{{ section.settings.badge_2 | default: 'Fast Shipping' }}</span>
    </div>
    <div class="trust-badge">
      <i class="ti ti-refresh"></i>
      <span>{{ section.settings.badge_3 | default: 'Easy Returns' }}</span>
    </div>
  </div>
</div>

<style>
.product-info-card {
  background: var(--vuexy-card-bg, #fff);
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
}

.product-vendor {
  display: inline-block;
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--vuexy-primary, #7367f0);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.5rem;
}

.product-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--vuexy-heading-color, #5d596c);
  margin-bottom: 0.75rem;
  line-height: 1.3;
}

.rating-section {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.rating-stars {
  display: flex;
  gap: 2px;
}

.rating-stars i {
  color: #ffba00;
  font-size: 1rem;
}

.rating-count {
  font-size: 0.875rem;
  color: var(--vuexy-body-color, #6f6b7d);
}

.cloudy-badge.badge-success {
  background: rgba(40, 199, 111, 0.12);
  color: #28c76f;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 500;
}

.product-price-box {
  margin: 1rem 0;
  padding: 1rem;
  background: #F5F5F7;
  border-radius: 10px;
  border: none;
}

.price-badge {
  display: inline-block;
  background: #ea5455;
  color: #fff;
  font-size: 0.7rem;
  font-weight: 600;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  text-transform: uppercase;
  margin-bottom: 0.5rem;
}

.price-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.current-price {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--vuexy-heading-color, #5d596c);
}

.compare-price {
  font-size: 1rem;
  color: var(--vuexy-muted-color, #a5a3ae);
  text-decoration: line-through;
}

.save-badge {
  background: rgba(40, 199, 111, 0.12);
  color: #28c76f;
  font-size: 0.75rem;
  font-weight: 600;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
}

.delivery-card-green {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  padding: 1rem;
  background: rgba(40, 199, 111, 0.08);
  border-radius: 10px;
  margin-bottom: 1rem;
}

.delivery-card-green .delivery-icon {
  width: 40px;
  height: 40px;
  background: #28c76f;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: 1.25rem;
  flex-shrink: 0;
}

.delivery-card-green .delivery-content {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
}

.delivery-card-green .delivery-title {
  font-weight: 600;
  color: var(--vuexy-heading-color, #5d596c);
}

.delivery-card-green .delivery-time {
  color: #28c76f;
  font-weight: 600;
  font-size: 0.875rem;
}

.delivery-card-green .delivery-order-by {
  font-size: 0.8125rem;
  color: var(--vuexy-muted-color, #a5a3ae);
}

.quantity-section {
  margin-bottom: 1rem;
}

.quantity-label {
  display: block;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--vuexy-heading-color, #5d596c);
  margin-bottom: 0.5rem;
}

.quantity-control {
  display: inline-flex;
  border: 1px solid var(--vuexy-border-color, #dbdade);
  border-radius: 8px;
  overflow: hidden;
}

.quantity-control .qty-btn {
  width: 40px;
  height: 40px;
  border: none;
  background: var(--vuexy-body-bg, #f4f5fa);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--vuexy-heading-color, #5d596c);
  transition: all 0.2s;
}

.quantity-control .qty-btn:hover {
  background: var(--vuexy-primary-lighter, #f3f2ff);
  color: var(--vuexy-primary, #7367f0);
}

.quantity-control .qty-input {
  width: 60px;
  height: 40px;
  border: none;
  border-left: 1px solid var(--vuexy-border-color, #dbdade);
  border-right: 1px solid var(--vuexy-border-color, #dbdade);
  text-align: center;
  font-weight: 600;
  font-size: 1rem;
}

.add-to-cart-btn {
  width: 100%;
  padding: 1rem;
  background: linear-gradient(135deg, var(--vuexy-primary, #7367f0) 0%, #8b5cf6 100%);
  color: #fff;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all 0.3s;
  margin-bottom: 0.75rem;
}

.add-to-cart-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(115, 103, 240, 0.4);
}

.add-to-cart-btn:disabled {
  background: var(--vuexy-muted-color, #a5a3ae);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.buy-now-btn {
  width: 100%;
  padding: 1rem;
  background: transparent;
  color: var(--vuexy-primary, #7367f0);
  border: 2px solid var(--vuexy-primary, #7367f0);
  border-radius: 10px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all 0.3s;
  margin-bottom: 1rem;
}

.buy-now-btn:hover {
  background: var(--vuexy-primary-lighter, #f3f2ff);
}

.trust-badges {
  display: flex;
  justify-content: center;
  gap: 1.5rem;
  padding-top: 1rem;
  border-top: 1px solid var(--vuexy-border-color, #dbdade);
}

.trust-badge {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.8125rem;
  color: var(--vuexy-muted-color, #a5a3ae);
}

.trust-badge i {
  color: #28c76f;
  font-size: 1rem;
}

/* Size + Quantity Same Row Layout */
.size-quantity-row {
  display: flex;
  gap: 1rem;
  margin-bottom: 1rem;
  align-items: flex-end;
}

.size-dropdown-col {
  flex: 1;
  min-width: 0;
}

.quantity-col {
  flex-shrink: 0;
}

.quantity-col .quantity-label {
  margin-bottom: 0.5rem;
}

.quantity-col .quantity-control {
  height: 44px;
}

.quantity-col .qty-btn {
  width: 44px;
  height: 44px;
}

.quantity-col .qty-input {
  width: 50px;
  height: 44px;
}

/* ===== MOBILE COMPACT ===== */
@media (max-width: 768px) {
  .product-info-card {
    padding: 1rem !important;
    border-radius: 12px !important;
  }
  
  .product-title {
    font-size: 1.2rem !important;
    margin-bottom: 0.5rem !important;
  }
  
  .product-price-box {
    margin: 0.75rem 0 !important;
    padding: 0.75rem !important;
    border-radius: 8px !important;
  }
  
  .current-price {
    font-size: 1.5rem !important;
  }
  
  /* Rating Section - Compact Inline */
  .rating-section {
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
    gap: 0.5rem !important;
    margin-bottom: 0.5rem !important;
  }
  
  .rating-section .rating-stars {
    gap: 1px !important;
  }
  
  .rating-section .rating-stars i {
    font-size: 0.875rem !important;
  }
  
  .rating-section .rating-count {
    font-size: 0.75rem !important;
    white-space: nowrap !important;
  }
  
  /* Hide recommend badge on mobile */
  .rating-section .cloudy-badge.badge-success {
    display: none !important;
  }
  
  /* Delivery Card - Ultra Compact Mobile */
  .delivery-card-green {
    padding: 0.625rem 0.75rem !important;
    margin-bottom: 0.75rem !important;
    border-radius: 8px !important;
    gap: 0.625rem !important;
  }
  
  .delivery-card-green .delivery-icon {
    width: 32px !important;
    height: 32px !important;
    border-radius: 6px !important;
    font-size: 1rem !important;
  }
  
  .delivery-card-green .delivery-content {
    flex-direction: row !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    gap: 0.25rem 0.5rem !important;
  }
  
  .delivery-card-green .delivery-title {
    font-size: 0.8125rem !important;
  }
  
  .delivery-card-green .delivery-time {
    font-size: 0.75rem !important;
  }
  
  .delivery-card-green .delivery-order-by {
    font-size: 0.7rem !important;
    opacity: 0.7;
  }
  
  .trust-badges-inline {
    padding: 0.5rem !important;
    gap: 0.25rem !important;
    border-radius: 8px !important;
  }
  
  .trust-badge-item {
    gap: 0.25rem !important;
  }
  
  .trust-badge-item i {
    font-size: 1rem !important;
  }
  
  .trust-badge-item span {
    font-size: 0.65rem !important;
  }
  
  .add-to-cart-btn {
    padding: 0.875rem !important;
    font-size: 0.95rem !important;
  }
  
  .quantity-control {
    height: 40px !important;
  }
  
  .qty-btn {
    width: 36px !important;
    height: 40px !important;
  }
  
  .qty-input {
    width: 45px !important;
    height: 40px !important;
  }
}

@media (max-width: 480px) {
  .size-quantity-row {
    flex-direction: column;
    align-items: stretch;
    gap: 0.75rem;
  }
  
  .quantity-col {
    width: 100%;
  }
  
  .quantity-col .quantity-control {
    width: 100%;
    justify-content: center;
  }
  
  .product-info-card {
    padding: 0.875rem !important;
    border-radius: 10px !important;
  }
  
  .product-title {
    font-size: 1.1rem !important;
  }
  
  .current-price {
    font-size: 1.35rem !important;
  }
  
  .variant-btn {
    padding: 0.35rem 0.625rem !important;
    font-size: 0.75rem !important;
    min-width: 40px !important;
  }
  
  /* Extra compact delivery for small phones */
  .delivery-card-green {
    padding: 0.5rem 0.625rem !important;
    gap: 0.5rem !important;
  }
  
  .delivery-card-green .delivery-icon {
    width: 28px !important;
    height: 28px !important;
    font-size: 0.875rem !important;
  }
  
  .delivery-card-green .delivery-title {
    font-size: 0.75rem !important;
  }
  
  .delivery-card-green .delivery-time {
    font-size: 0.7rem !important;
  }
  
  .delivery-card-green .delivery-order-by {
    display: none !important;
  }
  
  /* Rating even more compact */
  .rating-section .rating-stars i {
    font-size: 0.75rem !important;
  }
  
  .rating-section .rating-count {
    font-size: 0.7rem !important;
  }
}

/* Variant Options */
.variant-option-section {
  margin-bottom: 1rem;
}

.variant-label {
  display: block;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--vuexy-heading-color, #5d596c);
  margin-bottom: 0.5rem;
}

.variant-options {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.variant-btn {
  padding: 0.5rem 1rem;
  border: 1px solid var(--vuexy-border-color, #dbdade);
  background: #fff;
  border-radius: 8px;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--vuexy-body-color, #6f6b7d);
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 48px;
  text-align: center;
}

.variant-btn:hover:not(.disabled) {
  border-color: var(--vuexy-primary, #7367f0);
  color: var(--vuexy-primary, #7367f0);
}

.variant-btn.active {
  background: var(--vuexy-primary, #7367f0);
  border-color: var(--vuexy-primary, #7367f0);
  color: #fff;
}

.variant-btn.disabled {
  opacity: 0.4;
  cursor: not-allowed;
  text-decoration: line-through;
}

/* Variant Dropdown - Full Width Wrapper */
.variant-dropdown-wrapper {
  position: relative;
  width: 100%;
}

.variant-select-full {
  width: 100%;
  padding: 0.75rem 2.5rem 0.75rem 1rem;
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--vuexy-heading-color, #5d596c);
  background: #fff;
  border: 1px solid var(--vuexy-border-color, #dbdade);
  border-radius: 8px;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  transition: all 0.2s ease;
}

.variant-select-full:hover {
  border-color: var(--vuexy-primary, #7367f0);
}

.variant-select-full:focus {
  outline: none;
  border-color: var(--vuexy-primary, #7367f0);
  box-shadow: 0 0 0 3px rgba(115, 103, 240, 0.15);
}

.variant-select-icon {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--vuexy-muted-color, #a5a3ae);
  pointer-events: none;
  font-size: 1.125rem;
}

.variant-select-full option:disabled {
  color: #b9b9c3;
}

/* Legacy dropdown style (fallback) */
.variant-select {
  width: 100%;
  padding: 0.625rem 1rem;
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--vuexy-body-color, #6f6b7d);
  background: #fff;
  border: 1px solid var(--vuexy-border-color, #dbdade);
  border-radius: 8px;
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%236f6b7d' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  transition: all 0.2s ease;
}

.variant-select:hover {
  border-color: var(--vuexy-primary, #7367f0);
}

.variant-select:focus {
  outline: none;
  border-color: var(--vuexy-primary, #7367f0);
  box-shadow: 0 0 0 3px rgba(115, 103, 240, 0.15);
}

.variant-select option:disabled {
  color: #aaa;
}

@media (max-width: 575px) {
  .trust-badges {
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
  }
}
</style>

<script>
// Store product variants for lookup
window.productVariants = {{ product.variants | json }};

function selectVariantOption(optionName, optionValue, btn) {
  // Update active state on buttons
  const section = btn.closest('.variant-option-section');
  section.querySelectorAll('.variant-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  
  updateSelectedVariant();
}

function selectVariantFromDropdown(optionName, optionValue) {
  updateSelectedVariant();
}

function updateSelectedVariant() {
  // Collect all selected options (from buttons and dropdowns)
  const selectedOptions = {};
  
  document.querySelectorAll('.variant-option-section').forEach(sec => {
    // Check for active button
    const activeBtn = sec.querySelector('.variant-btn.active');
    if (activeBtn) {
      selectedOptions[activeBtn.dataset.optionName] = activeBtn.dataset.optionValue;
    }
    
    // Check for dropdown
    const select = sec.querySelector('.variant-select');
    if (select) {
      selectedOptions[select.dataset.optionName] = select.value;
    }
  });
  
  // Find variant matching all selected options
  const matchingVariant = window.productVariants.find(variant => {
    return Object.keys(selectedOptions).every((optName, index) => {
      return variant['option' + (index + 1)] === selectedOptions[optName];
    });
  });
  
  if (matchingVariant) {
    // Update hidden variant input
    document.getElementById('selectedVariant').value = matchingVariant.id;
    
    // Update price display
    const priceDisplay = document.getElementById('cartBtnPrice');
    const formatPrice = (price) => {
      if (window.Shopify && Shopify.formatMoney) {
        return Shopify.formatMoney(price);
      }
      return '$' + (price / 100).toFixed(2);
    };
    
    if (priceDisplay) {
      priceDisplay.textContent = formatPrice(matchingVariant.price);
    }
    
    // Update add to cart button state
    const addBtn = document.querySelector('.add-to-cart-btn');
    if (addBtn) {
      if (matchingVariant.available) {
        addBtn.disabled = false;
        addBtn.innerHTML = '<i class="ti ti-shopping-cart me-2"></i>Add to Cart - <span id="cartBtnPrice">' + formatPrice(matchingVariant.price) + '</span>';
      } else {
        addBtn.disabled = true;
        addBtn.innerHTML = '<i class="ti ti-shopping-cart me-2"></i>Sold Out';
      }
    }
    
    // Update URL with variant
    if (history.replaceState) {
      const url = new URL(window.location.href);
      url.searchParams.set('variant', matchingVariant.id);
      history.replaceState({}, '', url);
    }
  }
}

function changeQuantity(delta) {
  const input = document.getElementById('productQuantity');
  const cartQty = document.getElementById('cartQuantity');
  let value = parseInt(input.value) + delta;
  if (value < 1) value = 1;
  if (value > 999) value = 999;
  input.value = value;
  if (cartQty) cartQty.value = value;
}

document.addEventListener('DOMContentLoaded', function() {
  const qtyInput = document.getElementById('productQuantity');
  const cartQty = document.getElementById('cartQuantity');
  
  if (qtyInput) {
    qtyInput.addEventListener('change', function() {
      if (cartQty) cartQty.value = this.value;
    });
  }
  
  // Buy Now Button Handler - Adds to cart and redirects to checkout
  const buyNowBtn = document.querySelector('.buy-now-btn');
  if (buyNowBtn && !buyNowBtn.disabled) {
    buyNowBtn.addEventListener('click', async function() {
      const variantId = document.getElementById('selectedVariant')?.value;
      const quantity = document.getElementById('productQuantity')?.value || 1;
      
      if (!variantId) return;
      
      this.disabled = true;
      this.innerHTML = '<i class="ti ti-loader ti-spin me-2"></i>Processing...';
      
      try {
        const res = await fetch('/cart/add.js', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: variantId, quantity: parseInt(quantity) })
        });
        
        if (res.ok) {
          window.location.href = '/checkout';
        } else {
          throw new Error('Failed to add');
        }
      } catch (err) {
        this.disabled = false;
        this.innerHTML = '<i class="ti ti-bolt me-2"></i>Buy Now';
        alert('Could not process. Please try again.');
      }
    });
  }
});
</script>

{% schema %}
{
  "name": "Product Info Card",
  "tag": "section",
  "class": "product-info-card-section",
  "settings": [
    {
      "type": "header",
      "content": "‚≠ê Rating Section"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show Rating",
      "default": true,
      "info": "Toggle to show/hide rating area"
    },
    {
      "type": "text",
      "id": "rating_score",
      "label": "Rating Score",
      "default": "4.8"
    },
    {
      "type": "text",
      "id": "review_count",
      "label": "Review Count",
      "default": "2,847"
    },
    {
      "type": "text",
      "id": "recommend_percent",
      "label": "Recommend Percent",
      "default": "99%"
    },
    {
      "type": "header",
      "content": "üöö Delivery Card"
    },
    {
      "type": "checkbox",
      "id": "show_delivery",
      "label": "Show Delivery Card",
      "default": true,
      "info": "Toggle to show/hide delivery info"
    },
    {
      "type": "text",
      "id": "delivery_time",
      "label": "Delivery Time",
      "default": "Tomorrow 5PM ‚Äì 9PM"
    },
    {
      "type": "text",
      "id": "order_by",
      "label": "Order By Text",
      "default": "Order by 3PM"
    },
    {
      "type": "header",
      "content": "üìê Size Display"
    },
    {
      "type": "select",
      "id": "size_display_type",
      "label": "Size Option Style",
      "options": [
        { "value": "buttons", "label": "Buttons" },
        { "value": "dropdown", "label": "Dropdown" }
      ],
      "default": "buttons",
      "info": "Buttons = clickable pills, Dropdown = select menu"
    },
    {
      "type": "header",
      "content": "üí∞ Price Settings"
    },
    {
      "type": "text",
      "id": "price_badge",
      "label": "Price Badge Text",
      "default": "LIMITED TIME OFFER",
      "info": "Leave empty to hide badge"
    },
    {
      "type": "header",
      "content": "üõ°Ô∏è Trust Badges"
    },
    {
      "type": "text",
      "id": "badge_1",
      "label": "Badge 1",
      "default": "Secure Checkout"
    },
    {
      "type": "text",
      "id": "badge_2",
      "label": "Badge 2",
      "default": "Fast Shipping"
    },
    {
      "type": "text",
      "id": "badge_3",
      "label": "Badge 3",
      "default": "Easy Returns"
    }
  ],
  "presets": [
    {
      "name": "Product Info Card"
    }
  ]
}
{% endschema %}
